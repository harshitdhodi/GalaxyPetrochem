import{c as e,da as a,ah as s,dk as t,j as l,C as i,aD as c,I as d,B as r,X as m,an as n}from"./main-CYgOQvaw.js";import{b as o}from"./vendor-BCMiqwDy.js";import{b as x}from"./index.esm-nvYjwl0o.js";import{t as h,o as p,a as j,s as u,b as y}from"./index-DNG4Sede.js";import{S as b,a as g,b as f,c as N,d as v}from"./select-C9JtKdjQ.js";import"./utils-ZFgnvnbw.js";import"./index-D3SX27xu.js";import"./index-prcspqn7.js";import"./check-BmKpgWX1.js";import"./chevron-up-LTThVSTS.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=e("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),S=p({category:u().min(1,"Please select a category"),template:u().min(1,"Please select a template"),email:u().min(1,"To field is required").email("Invalid email format"),cc_email:y(u()).optional(),subject:u().min(1,"Subject is required"),body:u().min(1,"Body is required"),attachment:j().optional()});function C({defaultTo:e="",onSuccess:p}){const[j,u]=o.useState(!1),{data:y,isLoading:C}=a(),{data:F,isLoading:E}=s(),[k,{isLoading:_}]=t(),[T,B]=o.useState(null),[L,D]=o.useState([]),[P,q]=o.useState([]),{register:z,handleSubmit:V,formState:{errors:I},reset:A,watch:H,setValue:M}=x({resolver:h(S)}),R=H("category"),U=H("template"),G=H("body");o.useEffect((()=>{if(U&&F?.data){const e=F.data.find((e=>e._id===U));e&&(M("subject",e.subject),M("body",e.body))}}),[U,F,M]),o.useEffect((()=>{e&&M("email",e)}),[e,M]);return o.useEffect((()=>{if(R&&F?.data){const e=F.data.filter((e=>e.category?.emailCategory===R));q(e),M("template","")}}),[R,F,M]),l.jsx(i,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:l.jsx(c,{className:"p-6 overflow-y-auto",children:l.jsxs("form",{onSubmit:V((async e=>{const a=new FormData;a.append("email",e.email),a.append("cc_email",L),a.append("subject",e.subject),a.append("body",e.body),T&&a.append("attachment",T),u(!0);try{await k(a).unwrap(),alert("Email sent successfully!"),A(),B(null),D([]),p?.()}catch(s){alert("Failed to send email. Please try again.")}finally{u(!1)}})),className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),l.jsxs(b,{onValueChange:e=>M("category",e),children:[l.jsx(g,{id:"category",children:l.jsx(f,{placeholder:"Select Category"})}),l.jsx(N,{children:C?l.jsx(v,{disabled:!0,children:"Loading categories..."}):y&&y.length>0?y.map((e=>l.jsx(v,{value:e.emailCategory,children:e.emailCategory},e._id))):l.jsx(v,{disabled:!0,children:"No categories available"})})]}),I.category&&l.jsx("p",{className:"text-sm text-red-500",children:I.category.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),l.jsxs(b,{onValueChange:e=>M("template",e),disabled:!R,children:[l.jsx(g,{id:"template",children:l.jsx(f,{placeholder:R?"Select Email Template":"Please select a category first"})}),l.jsx(N,{children:E?l.jsx(v,{disabled:!0,children:"Loading templates..."}):0===P.length?l.jsx(v,{disabled:!0,children:"No templates in this category"}):P.map((e=>l.jsx(v,{value:e._id,children:e.name},e._id)))})]}),I.template&&l.jsx("p",{className:"text-sm text-red-500",children:I.template.message})]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),l.jsx(d,{id:"email",type:"text",placeholder:"Recipient email",...z("email"),"aria-invalid":I.email?"true":"false"}),I.email&&l.jsx("p",{className:"text-sm text-red-500",children:I.email.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),l.jsxs("div",{className:"relative",children:[l.jsx(d,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:e=>{var a;(a=e.target.value)&&!L.includes(a)&&D((e=>[...e,a])),e.target.value=""}}),L.length>0&&l.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:L.map(((e,a)=>l.jsxs("div",{className:"flex items-center justify-between py-1",children:[l.jsx("span",{className:"text-sm",children:e}),l.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{D((a=>a.filter(((a,s)=>s!==e))))})(a),children:l.jsx(m,{className:"h-3 w-3"})})]},a)))})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),l.jsx(d,{id:"subject",type:"text",placeholder:"Subject",...z("subject"),"aria-invalid":I.subject?"true":"false"}),I.subject&&l.jsx("p",{className:"text-sm text-red-500",children:I.subject.message})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),l.jsx(n,{value:G||"",onChange:e=>M("body",e),className:"bg-white"}),I.body&&l.jsx("p",{className:"text-sm text-red-500",children:I.body.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),l.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[l.jsx("input",{type:"file",onChange:e=>{const a=e.target.files[0];B(a)},className:"hidden",id:"file-upload"}),l.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[l.jsx(w,{className:"mx-auto h-12 w-12 text-gray-400"}),l.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),T&&l.jsx("div",{className:"mt-2",children:l.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[l.jsx("span",{className:"text-sm truncate",children:T.name}),l.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>{B(null)},children:l.jsx(m,{className:"h-4 w-4"})})]})})]}),l.jsx(r,{type:"submit",className:"w-full",disabled:j||_,children:j||_?"Sending...":"Send Email"})]})})})}export{C as default};
//# sourceMappingURL=EmailForm-CJKTlgoI.js.map
