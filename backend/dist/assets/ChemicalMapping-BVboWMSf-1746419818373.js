import{r as h,j as e,aE as w,an as I,I as N,B as A,bb as _,b8 as B,av as P,R as f}from"./index-CyqvOuOg-1746419818373.js";import{F as k}from"./Table-DNU6tJlT-1746419818373.js";import{S as F}from"./index-CJudDC91-1746419818373.js";import{S as L}from"./index-R-DGswdm-1746419818373.js";import{B as j}from"./index-C3bxH8TE-1746419818373.js";import{B as b}from"./react-toastify.esm-CROeYxIE-1746419818373.js";import{B as R}from"./BreadCrumb-DfKKMEZJ-1746419818373.js";import"./extends-rM07bN2b-1746419818373.js";import"./AntdIcon-DOEEMSan-1746419818373.js";import"./addEventListener-BJmGQME6-1746419818373.js";import"./toArray-CKiapHOW-1746419818373.js";import"./dropdown-DkYwa0fm-1746419818373.js";import"./EllipsisOutlined-BoRLgxJq-1746419818373.js";import"./getAllowClear-CJDPFZL7-1746419818373.js";import"./Input-CWHKnMyb-1746419818373.js";import"./CheckOutlined-C7ruoH1q-1746419818373.js";import"./chevron-right-DySda1U1-1746419818373.js";function M({chemicals:t,onRemoveChemical:p}){const[l,r]=h.useState(1),[n,a]=h.useState(10),d=Math.ceil(((t==null?void 0:t.length)||0)/n),i=(l-1)*n,c=i+n,g=t==null?void 0:t.slice(i,c),x=[{title:"Action",dataIndex:"action",render:(m,C)=>e.jsx(j,{type:"primary",danger:!0,size:"small",onClick:()=>p(C),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(k,{columns:x,dataSource:g,rowKey:"_id",pagination:!1}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Items per page:"," ",e.jsx(F,{value:n,onChange:m=>{a(m),r(1)},options:[{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"}],style:{width:80}})]}),e.jsxs(L,{children:[e.jsx(j,{type:"default",size:"small",onClick:()=>r(l-1),disabled:l===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i+1," - ",Math.min(c,(t==null?void 0:t.length)||0)," of"," ",(t==null?void 0:t.length)||0]}),e.jsx(j,{type:"default",size:"small",onClick:()=>r(l+1),disabled:l===d,children:"Next"})]})]})]})}function Q({selectedCustomer:t,refetchCustomer:p}){const[l,r]=h.useState(""),[n,a]=h.useState(""),[d,i]=h.useState(null),{data:c,isLoading:g}=w(n.charAt(0),{skip:n.length===0}),[x,{isLoading:m}]=I(),C=s=>{const u=s.target.value;r(u),a(u)},S=s=>{i(s),r(s.name),a("")},y=async()=>{if(!d||!t){b.error("Please select both customer and chemical");return}try{const s=d.id||d._id,u=t._id;await x({customerId:u,chemicalId:s}).unwrap(),r(""),i(null),await p(),b.success("Chemical added successfully")}catch(s){b.error(s.message||"Failed to add chemical")}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:l,onChange:C,className:"w-full mb-4",disabled:!t}),g&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),n&&(c==null?void 0:c.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:c.map(s=>e.jsx("li",{onClick:()=>S(s),className:"p-2 hover:bg-gray-200 cursor-pointer",children:s.name},s._id))}),e.jsx(A,{onClick:y,disabled:m||!d||!t,className:"mt-4 w-[10%] py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:m?"Adding...":"Add "})]})}function E({onSelectCustomer:t}){const[p,l]=h.useState(""),[r,n]=h.useState(""),[a,d]=h.useState(null),{data:i,isLoading:c,refetch:g}=_(r.charAt(0),{skip:r.length===0}),{data:x,refetch:m}=B(a==null?void 0:a._id,{skip:!(a!=null&&a._id)}),[C]=P(),S=o=>{d(o),l(o.name),n(""),t(o)},y=o=>{const v=o.target.value;l(v),n(v)},s=async o=>{try{await C({customerId:a._id,chemicalId:o._id}).unwrap(),await Promise.all([m(),g()]),b.success("Chemical removed successfully")}catch(v){console.error("Error removing chemical:",v),b.error("Failed to remove chemical")}},u=(x==null?void 0:x.data)||a;return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Customer",value:p,onChange:y,className:"w-full mb-4"}),c?e.jsx("div",{children:"Loading..."}):r&&i&&i.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:i.map(o=>e.jsx("li",{onClick:()=>S(o),className:"p-2 hover:bg-gray-200 cursor-pointer",children:o.name},o._id))}),e.jsx(Q,{selectedCustomer:u,refetchCustomer:async()=>{await Promise.all([m(),g()])}}),u&&e.jsx(M,{chemicals:u.chemicalId||[],onRemoveChemical:s})]})}const T=[{label:"Dashboard",href:"/dashboard"},{label:"Chemical Mapping",href:null}];function ae(){const[t,p]=f.useState(null),[l,r]=f.useState([]),n=a=>{p(a),r([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ml-1",children:e.jsx(R,{items:T})}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Customer"}),e.jsx("div",{className:"space-y-4",children:e.jsx(E,{onSelectCustomer:n})})]})]})}export{ae as default};
