import{c as Le,r as l,au as Fe,j as e,av as Q,aw as Te,B as C,ax as H,ay as te,az as re,I as U,aA as ke,aB as De,aC as Ee,aD as ie,aE as Me,aF as ne,aG as _e,T as J,l as Y,m as L,n,o as K,p as c,aH as W,aI as ce,aJ as Pe,aK as Ie,aL as Be,aM as $e,u as Oe,g as le,L as Re,aN as ze,aO as Ge}from"./index-CUXZutor-1745928740359.js";import{S as oe,a as de,b as he,c as me,d as _}from"./select-B-f6K5PV-1745928740359.js";import{D as Qe,a as He,b as Ue,c as G}from"./dropdown-menu-MDWimeH0-1745928740359.js";import{C as ue}from"./checkbox-mkDNwrYj-1745928740359.js";import"./textarea-DX_Bd5tg-1745928740359.js";import{S as R}from"./sweetalert2.esm.all-B0Dix5B2-1745928740359.js";import{M as Ve}from"./mail-B60_ayUd-1745928740359.js";import{A as qe,a as Je,b as Ye,c as Ke,d as We,e as Xe,f as Ze,g as es}from"./alert-dialog-G4iudNbu-1745928740359.js";import{P as xe}from"./plus-DA-NZr_T-1745928740359.js";import{C as ss}from"./chevron-left-kB_DF8HY-1745928740359.js";import{C as ls}from"./chevron-right-Dflh6TDS-1745928740359.js";import{C as as}from"./circle-plus-BUi7qQH2-1745928740359.js";import{E as ts}from"./ellipsis-vertical-D1TFFCxx-1745928740359.js";import"./index-DK1T2JRm-1745928740359.js";import"./index-DcTQ3MC1-1745928740359.js";import"./check-CDb9Y_JL-1745928740359.js";import"./chevron-up-BOkQya3b-1745928740359.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=Le("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),je=({selectedSupplier:D,supplier:h,email:f,name:j,type:m,chemicalName:w})=>{var b,A;console.log("Type:",m),console.log("Supplier Array:",h),console.log("Supplier Email:",(b=h[0])==null?void 0:b.email),console.log("Condition Check:",m==="Customer",h.length>0);const[r,x]=l.useState(""),[N,y]=l.useState(""),[p,T]=l.useState(!1),[g,F]=l.useState(null),{data:u,isLoading:E,error:v}=Fe(),t=(u==null?void 0:u.data)||[],o=m==="Customer"&&Array.isArray(h)&&((A=h[0])!=null&&A.email)?h[0].email:f;console.log("Recipient Email:",o),l.useEffect(()=>{console.log("Supplier updated:",h)},[h]);const k=async()=>{try{T(!0);const d={subject:N,message:r,recipients:Array.isArray(o)?o:[o],chemicalNames:Array.isArray(w)?w:[w]},a=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),S=await a.json();if(!a.ok)throw new Error(S.message||"Failed to send email");alert("Email sent successfully!"),x(""),y("")}catch(d){console.log("Error sending email:",d),alert("Failed to send email: "+d.message)}finally{T(!1)}},M=d=>{const a=t.find(S=>S._id===d);F(a),x((a==null?void 0:a.body)||""),y((a==null?void 0:a.subject)||"")};return e.jsx("div",{children:e.jsxs(Q,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs(C,{variant:"secondary",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Send Email (",D.length,")"]})}),e.jsxs(H,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(re,{children:"Send Email to Selected Suppliers"})}),e.jsxs("div",{className:"grid gap-4 ",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:o})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:e.jsx("div",{className:"text-sm py-1",children:w})})]})]}),e.jsxs(oe,{onValueChange:M,children:[e.jsx(de,{children:e.jsx(he,{placeholder:"Select email template"})}),e.jsx(me,{children:E?e.jsx(_,{value:"",disabled:!0,children:"Loading..."}):v?e.jsx(_,{value:"",disabled:!0,children:"Error loading templates"}):t.map(d=>e.jsx(_,{value:d._id,children:d.name},d._id))})]}),e.jsx(U,{placeholder:"Subject",value:N,onChange:d=>y(d.target.value)}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:e.jsx(ke,{value:r,onChange:x,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),e.jsx(C,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:k,disabled:p,children:p?"Sending...":"Send Email"})]})]})]})})},X=({refetch:D,open:h,onClose:f,chemicalName:j,fetchChemicals:m,chemicalId:w,supplier:r,onAddSupplier:x=[]})=>{const[N,y]=l.useState(""),[p,T]=l.useState(null);l.useEffect(()=>{h&&(y(""),T(null))},[h]);const[g,{isLoading:F}]=r==="Supplier"?De():Ee(),u=Array.isArray(x)?x.filter(t=>{var o;return(o=t.name)==null?void 0:o.toLowerCase().includes(N.toLowerCase())}):[],E=async()=>{if(!p){console.log("No supplier or customer selected");return}try{let t;r==="Supplier"?t=await g({chemical_ids:[j._id],supplierId:p._id}).unwrap():t=await g({chemicalId:[j._id],customerId:p._id}).unwrap(),console.log(`${r} ${p.name} added to ${j.name}`),await D(),m(),f()}catch(t){console.error(`Failed to add ${r.toLowerCase()}:`,t),alert(`Failed to add ${r.toLowerCase()}. Please try again.`)}},v=t=>{T(t),y(t.name)};return e.jsx(Q,{open:h,onOpenChange:t=>!t&&f(),children:e.jsxs(H,{className:"max-w-lg p-6",children:[e.jsx(te,{children:e.jsxs(re,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",r," for ",j.name]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(U,{placeholder:`Search ${r}`,value:N,onChange:t=>y(t.target.value),className:"w-full mb-2"}),N&&!p&&e.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:u.length>0?u.map(t=>e.jsx("div",{onClick:()=>v(t),className:"p-2 cursor-pointer hover:bg-gray-100",children:t.name},t.id)):e.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",r.toLowerCase(),"s"]})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(C,{onClick:E,className:"bg-[#3b1f91] hover:bg-purple-700",disabled:F||!p,children:F?"Adding...":"+ Add"}),e.jsx(C,{onClick:f,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function rs({chemicalName:D,supplier:h,fetchChemicals:f,chemicalId:j}){console.log(j);const[m,w]=l.useState([]),[r,x]=l.useState(!1),[N,y]=l.useState(""),[p,T]=l.useState(""),[g,F]=l.useState(""),[u,E]=l.useState(""),[v,t]=l.useState(null),{selectedItem:o}=l.useContext(ie),{data:k=[],isLoading:M,error:b,refetch:A}=Me(j),{data:d}=ne(),[a,{isLoading:S}]=_e(),B=k.filter(i=>i.name.toLowerCase().includes(N.toLowerCase())&&i.email.toLowerCase().includes(p.toLowerCase())&&i.mobile.toLowerCase().includes(g.toLowerCase())&&i.country.toLowerCase().includes(u.toLowerCase())),Z=i=>{w(z=>z.includes(i)?z.filter(q=>q!==i):[...z,i])},ee=i=>{t(i)},V=async()=>{if(v)try{await a({supplierId:v,chemicalId:j}).unwrap(),A()}catch(i){console.error("Failed to delete chemical:",i),alert("Failed to delete chemical")}t(null)};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[h," for ",(o==null?void 0:o.name)||"Chemical"]}),e.jsxs(C,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>x(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),D&&e.jsx(X,{open:r,onClose:()=>x(!1),chemicalName:o||"Unknown Chemical",supplier:"Supplier",onAddSupplier:d,chemicalId:j,refetch:A,fetchChemicals:f})]}),m.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:m,supplier:k,email:k.filter(i=>m.includes(i._id)).map(i=>i.email).join(", "),name:k.filter(i=>m.includes(i._id)).map(i=>i.name).join(", "),chemicalName:o==null?void 0:o.name})}),e.jsxs(J,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(n,{className:"w-12"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Mobile"}),e.jsx(n,{children:"Action"})]})}),e.jsxs(K,{children:[M&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),b&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!M&&!b&&B.map(i=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsx(ue,{checked:m.includes(i._id),onCheckedChange:()=>Z(i._id)})}),e.jsx(c,{children:i.name}),e.jsx(c,{children:i.email}),e.jsx(c,{children:i.mobile}),e.jsx(c,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>ee(i._id),disabled:S,children:e.jsx(W,{className:"w-4 h-4"})})})]},i._id))]})]}),e.jsx(qe,{open:!!v,onOpenChange:()=>t(null),children:e.jsxs(Je,{children:[e.jsxs(Ye,{children:[e.jsx(Ke,{children:"Are you sure?"}),e.jsx(We,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),e.jsxs(Xe,{children:[e.jsx(Ze,{children:"Cancel"}),e.jsx(es,{onClick:V,children:"Delete"})]})]})})]})}function is({chemicalName:D,supplier:h}){const[f,j]=l.useState([]),{selectedItem:m}=l.useContext(ie),[w,r]=l.useState(!1),[x,N]=l.useState(""),[y,p]=l.useState(""),[T,g]=l.useState(""),[F,u]=l.useState(""),{data:E=[]}=ce(),{data:v=[],isLoading:t,error:o,refetch:k}=Pe(m._id),[M]=Ie(),b=v.filter(a=>a.name.toLowerCase().includes(x.toLowerCase())&&a.email.toLowerCase().includes(y.toLowerCase())&&a.mobile.toLowerCase().includes(T.toLowerCase())&&a.country.toLowerCase().includes(F.toLowerCase())),A=a=>{j(S=>S.includes(a)?S.filter(B=>B!==a):[...S,a])};console.log(f);const d=async a=>{try{await M({customerId:a,chemicalId:m._id})}catch(S){console.error("Failed to remove customer:",S)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[h," for ",m.name]}),e.jsxs(C,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>r(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),e.jsx(X,{open:w,onClose:()=>r(!1),chemicalName:m,supplier:"Customer",onAddSupplier:E,refetch:k}),f.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:f,supplier:v,chemicalName:D.name,type:h})}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs(J,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(n,{className:"w-12"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Mobile"}),e.jsx(n,{children:"Country"}),e.jsx(n,{children:"Action"})]})}),e.jsxs(K,{children:[t&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),o&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!t&&!o&&b.length===0&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!t&&!o&&b.map(a=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsx(ue,{checked:f.includes(a.id),onCheckedChange:()=>A(a.id)})}),e.jsx(c,{children:a.name}),e.jsx(c,{children:a.email}),e.jsx(c,{children:a.mobile}),e.jsx(c,{children:a.country}),e.jsx(c,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>d(a._id),children:e.jsx(W,{className:"w-4 h-4"})})})]},a.id))]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Items per page: 10"}),e.jsxs("span",{children:["1 - ",b.length," of ",b.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(ss,{className:"w-4 h-4"})}),e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(ls,{className:"w-4 h-4"})})]})]})]})]})}function ys(){const{selectedChemicalName:D,setChemicalName:h}=Be(),[f,j]=l.useState(!1),[m,w]=l.useState(!1),[r,x]=l.useState(null),[N,y]=l.useState(""),[p,T]=l.useState(""),[g,F]=l.useState(1),[u,E]=l.useState(20),[v,t]=l.useState(!1),[o,k]=l.useState(null),[M,b]=l.useState(!1),[A,d]=l.useState(null),[a,S]=l.useState([]),{data:B=[],isLoading:Z,error:ee}=ne(),{data:V=[],isLoading2:i,error2:z}=ce();$e(r==null?void 0:r._id);const q=Oe(),[pe,se]=l.useState(0);l.useEffect(()=>{P()},[pe]);const P=async()=>{try{const s=await le.get("/api/chemical/get");S(s.data)}catch(s){console.error("Error fetching chemicals:",s)}},$=a.filter(s=>{const I=s.name||"",O=s.casNumber||"";return I.toLowerCase().includes(N.toLowerCase())&&O.includes(p)}),ge=$.slice((g-1)*u,g*u),Ce=()=>{g*u<$.length&&F(s=>s+1)},fe=()=>{g>1&&F(s=>s-1)},Se=s=>{E(Number(s)),F(1)},be=s=>{console.log("Edit",s),q(`/edit-chemical-form/${s._id}`)},we=s=>{x(s),t(!0),d("supplier")},Ne=s=>{x(s),b(!0),d("customer")},ye=async s=>{try{if((await R.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const O=await le.delete(`/api/chemical/delete?id=${s._id}`);if(O.data.success||O.data.message==="Chemical deleted successfully")S(ve=>ve.filter(Ae=>Ae._id!==s._id)),await P(),await R.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1});else throw new Error(O.data.message||"Failed to delete the chemical")}else R.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(I){console.error("Error deleting chemical:",I),I.message==="Chemical deleted successfully"?R.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):R.fire({title:"Error!",text:I.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),e.jsx("div",{children:e.jsx(Re,{to:"/chemical-form",children:e.jsxs(C,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[e.jsx(as,{})," Add Chemical"]})})})]}),e.jsx("div",{className:"mb-5",children:e.jsx("hr",{})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsxs(Y,{children:[e.jsxs(L,{children:[e.jsx(n,{className:"w-[50px]"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"CAS Number"}),e.jsx(n,{children:"Molecular Formula"}),e.jsx(n,{children:"Suppliers"}),e.jsx(n,{children:"Customers"}),e.jsx(n,{children:"Unit Name"})]}),e.jsxs(L,{children:[e.jsx(n,{className:"w-[50px]"}),e.jsx(n,{children:e.jsx(U,{placeholder:"Filter by Name",value:N,onChange:s=>y(s.target.value)})}),e.jsx(n,{children:e.jsx(U,{placeholder:"Filter by CAS Number",value:p,onChange:s=>T(s.target.value)})}),e.jsx(n,{}),e.jsx(n,{}),e.jsx(n,{}),e.jsx(n,{})]})]}),e.jsx(K,{children:ge.map(s=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsxs(Qe,{children:[e.jsx(He,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(ts,{className:"h-4 w-4"})})}),e.jsxs(Ue,{children:[e.jsxs(G,{onClick:()=>be(s),children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(G,{onClick:()=>we(s),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),e.jsxs(G,{onClick:()=>Ne(s),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),e.jsxs(G,{onClick:()=>ye(s),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.cas_number}),e.jsx(c,{children:s.molecular_formula}),e.jsx(c,{children:e.jsxs(C,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{x(s),j(!0)},children:["Suppliers (",s.supplierCount,")"]})}),e.jsx(c,{children:e.jsxs(C,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{x(s),w(!0)},children:["Customers(",s.customerCount,")"]})}),e.jsx(c,{children:s.unit})]},s.id))}),r&&e.jsx(X,{open:A==="supplier"?v:M,onClose:()=>{A==="supplier"?t(!1):b(!1),d(null),se(s=>s+1),P()},chemicalName:r.name,supplier:A==="supplier"?"Supplier":"Customer",onAddSupplier:A==="supplier"?B:V,chemicalId:r._id,fetchChemicals:P})]})}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),e.jsxs(oe,{defaultValue:u.toString(),onValueChange:Se,children:[e.jsx(de,{className:"w-[70px]",children:e.jsx(he,{placeholder:u.toString()})}),e.jsxs(me,{children:[e.jsx(_,{value:"10",children:"10"}),e.jsx(_,{value:"20",children:"20"}),e.jsx(_,{value:"30",children:"30"}),e.jsx(_,{value:"40",children:"40"}),e.jsx(_,{value:"50",children:"50"})]})]}),e.jsx("div",{className:"text-sm font-medium",children:`${(g-1)*u+1} - ${Math.min(g*u,$.length)} of ${$.length}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{variant:"outline",size:"icon",onClick:fe,disabled:g===1,children:"<"}),e.jsx(C,{variant:"outline",size:"icon",onClick:Ce,disabled:g*u>=$.length,children:">"})]})]}),e.jsx(Ge,{selectedItem:r,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:f,onOpenChange:j,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(rs,{chemicalName:r,chemicalId:r._id,supplier:"Supplier",fetchChemicals:P})})}),e.jsx(Q,{open:m,onOpenChange:w,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(is,{selectedItems:r,supplier:"Customer",chemicalName:r,chemicalId:r._id,onUpdate:()=>{P(),se(s=>s+1)}})})})]})})]})}export{ys as default};
