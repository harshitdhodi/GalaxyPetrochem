import{c as e,g as s,j as a,D as l,h as i,B as r,k as c,l as t,m as n,I as d,n as o,o as h,C as m,p as x,q as u,r as j,P as p,T as f,s as g,t as C,v as N,w as b,x as v,S as w,y}from"./main-DbCIA5nM.js";import{b as S,f as L,L as k}from"./vendor-X2E3PIZN.js";import{T as A,a as _,b as I,c as E,d as T,e as F}from"./table-DVNdpQ_I.js";import{S as B,a as D,b as z,c as M,d as O}from"./select-BGPtewlQ.js";import{D as $,a as q,b as P,c as U}from"./dropdown-menu-C0TLOZFq.js";import{C as V}from"./checkbox-B4CvUtyY.js";import"./textarea-uyS90DRv.js";import{S as Y}from"./sweetalert2.esm.all-D2QuJ--x.js";import{R as H}from"./quill.snow-BtYlbvM3.js";import{M as W}from"./mail-BCOKffyH.js";import{A as G,a as J,b as K,c as R,d as X,e as Z,f as Q,g as ee}from"./alert-dialog-DoWNvkno.js";import{C as se}from"./chevron-left-BDxeQhcw.js";import{C as ae}from"./chevron-right-BX1oQPFZ.js";import{a as le}from"./utils-ZFgnvnbw.js";import{C as ie}from"./circle-plus-DmPFdJDU.js";import{E as re}from"./ellipsis-vertical-BYn5zANP.js";import"./index-BoWlxZtN.js";import"./index-DPOpahcV.js";import"./check-DSfnMMtB.js";import"./chevron-up-D_C2ouKf.js";import"./isEqual-12EnfSUl.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=e("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),te=({selectedSupplier:e,supplier:o,email:h,name:m,type:x,chemicalName:u})=>{const[j,p]=S.useState(""),[f,g]=S.useState(""),[C,N]=S.useState(!1),[b,v]=S.useState(null),{data:w,isLoading:y,error:L}=s(),k=w?.data||[],A="Customer"===x&&Array.isArray(o)&&o[0]?.email?o[0].email:h;S.useEffect((()=>{}),[o]);return a.jsx("div",{children:a.jsxs(l,{children:[a.jsx(i,{asChild:!0,children:a.jsxs(r,{variant:"secondary",children:[a.jsx(W,{className:"w-4 h-4 mr-2"}),"Send Email (",e.length,")"]})}),a.jsxs(c,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsx(t,{children:a.jsx(n,{children:"Send Email to Selected Suppliers"})}),a.jsxs("div",{className:"grid gap-4 ",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),a.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:A})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),a.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:a.jsx("div",{className:"text-sm py-1",children:u})})]})]}),a.jsxs(B,{onValueChange:e=>{const s=k.find((s=>s._id===e));v(s),p(s?.body||""),g(s?.subject||"")},children:[a.jsx(D,{children:a.jsx(z,{placeholder:"Select email template"})}),a.jsx(M,{children:y?a.jsx(O,{value:"",disabled:!0,children:"Loading..."}):L?a.jsx(O,{value:"",disabled:!0,children:"Error loading templates"}):k.map((e=>a.jsx(O,{value:e._id,children:e.name},e._id)))})]}),a.jsx(d,{placeholder:"Subject",value:f,onChange:e=>g(e.target.value)}),a.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:a.jsx(H,{value:j,onChange:p,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),a.jsx(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:async()=>{try{N(!0);const e={subject:f,message:j,recipients:Array.isArray(A)?A:[A],chemicalNames:Array.isArray(u)?u:[u]},s=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await s.json();if(!s.ok)throw new Error(a.message||"Failed to send email");alert("Email sent successfully!"),p(""),g("")}catch(e){alert("Failed to send email: "+e.message)}finally{N(!1)}},disabled:C,children:C?"Sending...":"Send Email"})]})]})]})})},ne=({refetch:e,open:s,onClose:i,chemicalName:m,fetchChemicals:x,chemicalId:u,supplier:j,onAddSupplier:p=[]})=>{const[f,g]=S.useState(""),[C,N]=S.useState(null);S.useEffect((()=>{s&&(g(""),N(null))}),[s]);const[b,{isLoading:v}]="Supplier"===j?o():h(),w=Array.isArray(p)?p.filter((e=>e.name?.toLowerCase().includes(f.toLowerCase()))):[];return a.jsx(l,{open:s,onOpenChange:e=>!e&&i(),children:a.jsxs(c,{className:"max-w-lg p-6",children:[a.jsx(t,{children:a.jsxs(n,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",j," for ",m.name]})}),a.jsxs("div",{className:"mt-4",children:[a.jsx(d,{placeholder:`Search ${j}`,value:f,onChange:e=>g(e.target.value),className:"w-full mb-2"}),f&&!C&&a.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:w.length>0?w.map((e=>a.jsx("div",{onClick:()=>(e=>{N(e),g(e.name)})(e),className:"p-2 cursor-pointer hover:bg-gray-100",children:e.name},e.id))):a.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",j.toLowerCase(),"s"]})}),a.jsxs("div",{className:"flex justify-between mt-4",children:[a.jsx(r,{onClick:async()=>{if(C)try{let s;s="Supplier"===j?await b({chemical_ids:[m._id],supplierId:C._id}).unwrap():await b({chemicalId:[m._id],customerId:C._id}).unwrap(),await e(),x(),i()}catch(s){alert(`Failed to add ${j.toLowerCase()}. Please try again.`)}},className:"bg-[#3b1f91] hover:bg-purple-700",disabled:v||!C,children:v?"Adding...":"+ Add"}),a.jsx(r,{onClick:i,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function de({chemicalName:e,supplier:s,fetchChemicals:l,chemicalId:i}){const[c,t]=S.useState([]),[n,d]=S.useState(!1),[o,h]=S.useState(""),[g,C]=S.useState(""),[N,b]=S.useState(""),[v,w]=S.useState(""),[y,L]=S.useState(null),{selectedItem:k}=S.useContext(m),{data:B=[],isLoading:D,error:z,refetch:M}=x(i),{data:O}=u(),[$,{isLoading:q}]=j(),P=B.filter((e=>e.name.toLowerCase().includes(o.toLowerCase())&&e.email.toLowerCase().includes(g.toLowerCase())&&e.mobile.toLowerCase().includes(N.toLowerCase())&&e.country.toLowerCase().includes(v.toLowerCase())));return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[s," for ",k?.name||"Chemical"]}),a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>d(!0),children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),e&&a.jsx(ne,{open:n,onClose:()=>d(!1),chemicalName:k||"Unknown Chemical",supplier:"Supplier",onAddSupplier:O,chemicalId:i,refetch:M,fetchChemicals:l})]}),c.length>0&&a.jsx("div",{className:"p-4 border-b",children:a.jsx(te,{selectedSupplier:c,supplier:B,email:B.filter((e=>c.includes(e._id))).map((e=>e.email)).join(", "),name:B.filter((e=>c.includes(e._id))).map((e=>e.name)).join(", "),chemicalName:k?.name})}),a.jsxs(A,{children:[a.jsx(_,{children:a.jsxs(I,{children:[a.jsx(E,{className:"w-12"}),a.jsx(E,{children:"Name"}),a.jsx(E,{children:"Email"}),a.jsx(E,{children:"Mobile"}),a.jsx(E,{children:"Action"})]})}),a.jsxs(T,{children:[D&&a.jsx(I,{children:a.jsx(F,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),z&&a.jsx(I,{children:a.jsx(F,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!D&&!z&&P.map((e=>a.jsxs(I,{children:[a.jsx(F,{children:a.jsx(V,{checked:c.includes(e._id),onCheckedChange:()=>{return s=e._id,void t((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),a.jsx(F,{children:e.name}),a.jsx(F,{children:e.email}),a.jsx(F,{children:e.mobile}),a.jsx(F,{children:a.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>{return s=e._id,void L(s);var s},disabled:q,children:a.jsx(f,{className:"w-4 h-4"})})})]},e._id)))]})]}),a.jsx(G,{open:!!y,onOpenChange:()=>L(null),children:a.jsxs(J,{children:[a.jsxs(K,{children:[a.jsx(R,{children:"Are you sure?"}),a.jsx(X,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),a.jsxs(Z,{children:[a.jsx(Q,{children:"Cancel"}),a.jsx(ee,{onClick:async()=>{if(y)try{await $({supplierId:y,chemicalId:i}).unwrap(),M()}catch(e){alert("Failed to delete chemical")}L(null)},children:"Delete"})]})]})})]})}function oe({chemicalName:e,supplier:s}){const[l,i]=S.useState([]),{selectedItem:c}=S.useContext(m),[t,n]=S.useState(!1),[d,o]=S.useState(""),[h,x]=S.useState(""),[u,j]=S.useState(""),[b,v]=S.useState(""),{data:w=[]}=g(),{data:y=[],isLoading:L,error:k,refetch:B}=C(c._id),[D]=N(),z=y.filter((e=>e.name.toLowerCase().includes(d.toLowerCase())&&e.email.toLowerCase().includes(h.toLowerCase())&&e.mobile.toLowerCase().includes(u.toLowerCase())&&e.country.toLowerCase().includes(b.toLowerCase())));return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[s," for ",c.name]}),a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>n(!0),children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),a.jsx(ne,{open:t,onClose:()=>n(!1),chemicalName:c,supplier:"Customer",onAddSupplier:w,refetch:B}),l.length>0&&a.jsx("div",{className:"p-4 border-b",children:a.jsx(te,{selectedSupplier:l,supplier:y,chemicalName:e.name,type:s})}),a.jsxs("div",{className:"border rounded-lg",children:[a.jsxs(A,{children:[a.jsx(_,{children:a.jsxs(I,{children:[a.jsx(E,{className:"w-12"}),a.jsx(E,{children:"Name"}),a.jsx(E,{children:"Email"}),a.jsx(E,{children:"Mobile"}),a.jsx(E,{children:"Country"}),a.jsx(E,{children:"Action"})]})}),a.jsxs(T,{children:[L&&a.jsx(I,{children:a.jsx(F,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),k&&a.jsx(I,{children:a.jsx(F,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!L&&!k&&0===z.length&&a.jsx(I,{children:a.jsx(F,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!L&&!k&&z.map((e=>a.jsxs(I,{children:[a.jsx(F,{children:a.jsx(V,{checked:l.includes(e.id),onCheckedChange:()=>{return s=e.id,void i((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),a.jsx(F,{children:e.name}),a.jsx(F,{children:e.email}),a.jsx(F,{children:e.mobile}),a.jsx(F,{children:e.country}),a.jsx(F,{children:a.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>(async e=>{try{await D({customerId:e,chemicalId:c._id})}catch(s){}})(e._id),children:a.jsx(f,{className:"w-4 h-4"})})})]},e.id)))]})]}),a.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx("span",{children:"Items per page: 10"}),a.jsxs("span",{children:["1 - ",z.length," of ",z.length]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(r,{variant:"outline",size:"icon",disabled:!0,children:a.jsx(se,{className:"w-4 h-4"})}),a.jsx(r,{variant:"outline",size:"icon",disabled:!0,children:a.jsx(ae,{className:"w-4 h-4"})})]})]})]})]})}function he(){const{selectedChemicalName:e,setChemicalName:s}=b(),[i,t]=S.useState(!1),[n,o]=S.useState(!1),[h,m]=S.useState(null),[x,j]=S.useState(""),[p,C]=S.useState(""),[N,V]=S.useState(1),[H,W]=S.useState(20),[G,J]=S.useState(!1),[K,R]=S.useState(null),[X,Z]=S.useState(!1),[Q,ee]=S.useState(null),[se,ae]=S.useState([]),{data:te=[],isLoading:he,error:me}=u(),{data:xe=[],isLoading2:ue,error2:je}=g();v(h?._id);const pe=L(),[fe,ge]=S.useState(0);S.useEffect((()=>{Ce()}),[fe]);const Ce=async()=>{try{const e=await le.get("/api/chemical/get");ae(e.data)}catch(e){}},Ne=se.filter((e=>{const s=e.name||"",a=e.casNumber||"";return s.toLowerCase().includes(x.toLowerCase())&&a.includes(p)})),be=Ne.slice((N-1)*H,N*H);return a.jsxs("div",{className:"w-full",children:[a.jsxs("div",{className:"flex justify-between items-center mb-5",children:[a.jsx("div",{children:a.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),a.jsx("div",{children:a.jsx(k,{to:"/chemical-form",children:a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[a.jsx(ie,{})," Add Chemical"]})})})]}),a.jsx("div",{className:"mb-5",children:a.jsx("hr",{})}),a.jsx("div",{className:"rounded-md border",children:a.jsxs(A,{children:[a.jsxs(_,{children:[a.jsxs(I,{children:[a.jsx(E,{className:"w-[50px]"}),a.jsx(E,{children:"Name"}),a.jsx(E,{children:"CAS Number"}),a.jsx(E,{children:"Molecular Formula"}),a.jsx(E,{children:"Suppliers"}),a.jsx(E,{children:"Customers"}),a.jsx(E,{children:"Unit Name"})]}),a.jsxs(I,{children:[a.jsx(E,{className:"w-[50px]"}),a.jsx(E,{children:a.jsx(d,{placeholder:"Filter by Name",value:x,onChange:e=>j(e.target.value)})}),a.jsx(E,{children:a.jsx(d,{placeholder:"Filter by CAS Number",value:p,onChange:e=>C(e.target.value)})}),a.jsx(E,{}),a.jsx(E,{}),a.jsx(E,{}),a.jsx(E,{})]})]}),a.jsx(T,{children:be.map((e=>a.jsxs(I,{children:[a.jsx(F,{children:a.jsxs($,{children:[a.jsx(q,{asChild:!0,children:a.jsx("button",{className:"p-3",children:a.jsx(re,{className:"h-4 w-4"})})}),a.jsxs(P,{children:[a.jsxs(U,{onClick:()=>(e=>{pe(`/edit-chemical-form/${e._id}`)})(e),children:[a.jsx(w,{className:"mr-2 h-4 w-4"}),"Edit"]}),a.jsxs(U,{onClick:()=>(e=>{m(e),J(!0),ee("supplier")})(e),children:[a.jsx(ce,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),a.jsxs(U,{onClick:()=>(e=>{m(e),Z(!0),ee("customer")})(e),children:[a.jsx(ce,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),a.jsxs(U,{onClick:()=>(async e=>{try{if((await Y.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const s=await le.delete(`/api/chemical/delete?id=${e._id}`);if(!s.data.success&&"Chemical deleted successfully"!==s.data.message)throw new Error(s.data.message||"Failed to delete the chemical");ae((s=>s.filter((s=>s._id!==e._id)))),await Ce(),await Y.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1})}else Y.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(s){"Chemical deleted successfully"===s.message?Y.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):Y.fire({title:"Error!",text:s.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}})(e),children:[a.jsx(f,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),a.jsx(F,{children:e.name}),a.jsx(F,{children:e.cas_number}),a.jsx(F,{children:e.molecular_formula}),a.jsx(F,{children:a.jsxs(r,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{m(e),t(!0)},children:["Suppliers (",e.supplierCount,")"]})}),a.jsx(F,{children:a.jsxs(r,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{m(e),o(!0)},children:["Customers(",e.customerCount,")"]})}),a.jsx(F,{children:e.unit})]},e.id)))}),h&&a.jsx(ne,{open:"supplier"===Q?G:X,onClose:()=>{"supplier"===Q?J(!1):Z(!1),ee(null),ge((e=>e+1)),Ce()},chemicalName:h.name,supplier:"supplier"===Q?"Supplier":"Customer",onAddSupplier:"supplier"===Q?te:xe,chemicalId:h._id,fetchChemicals:Ce})]})}),a.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),a.jsxs(B,{defaultValue:H.toString(),onValueChange:e=>{W(Number(e)),V(1)},children:[a.jsx(D,{className:"w-[70px]",children:a.jsx(z,{placeholder:H.toString()})}),a.jsxs(M,{children:[a.jsx(O,{value:"10",children:"10"}),a.jsx(O,{value:"20",children:"20"}),a.jsx(O,{value:"30",children:"30"}),a.jsx(O,{value:"40",children:"40"}),a.jsx(O,{value:"50",children:"50"})]})]}),a.jsx("div",{className:"text-sm font-medium",children:`${(N-1)*H+1} - ${Math.min(N*H,Ne.length)} of ${Ne.length}`})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(r,{variant:"outline",size:"icon",onClick:()=>{N>1&&V((e=>e-1))},disabled:1===N,children:"<"}),a.jsx(r,{variant:"outline",size:"icon",onClick:()=>{N*H<Ne.length&&V((e=>e+1))},disabled:N*H>=Ne.length,children:">"})]})]}),a.jsx(y,{selectedItem:h,children:h&&a.jsxs(a.Fragment,{children:[a.jsx(l,{open:i,onOpenChange:t,children:a.jsx(c,{className:"max-w-6xl",children:a.jsx(de,{chemicalName:h,chemicalId:h._id,supplier:"Supplier",fetchChemicals:Ce})})}),a.jsx(l,{open:n,onOpenChange:o,children:a.jsx(c,{className:"max-w-6xl",children:a.jsx(oe,{selectedItems:h,supplier:"Customer",chemicalName:h,chemicalId:h._id,onUpdate:()=>{Ce(),ge((e=>e+1))}})})})]})})]})}export{he as default};
//# sourceMappingURL=ChemicalTablePage-Dyu968Cf.js.map
