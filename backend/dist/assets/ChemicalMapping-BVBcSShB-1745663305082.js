import{r as o,aB as w,j as e,I as N,B as I,g as A,aG as _,bl as k,bm as B,R as v}from"./index-pxV5F7Vk-1745663305082.js";import{F as M,P}from"./Table-pxMRLssz-1745663305082.js";import{M as L}from"./index-P_cC6cbe-1745663305082.js";import{B as R}from"./index-BybzuWVW-1745663305082.js";import"./styleChecker-BoENdDA2-1745663305082.js";import"./index-DRIINZSM-1745663305082.js";import"./EllipsisOutlined-D0B4H0TJ-1745663305082.js";import"./dropdown-CXDBCN-k-1745663305082.js";import"./getAllowClear-DWvMdzzD-1745663305082.js";import"./CheckOutlined-BIHi7Ikt-1745663305082.js";import"./Input-e0_lhlda-1745663305082.js";import"./index-Bzm-YIRd-1745663305082.js";import"./index-MyYFxghB-1745663305082.js";import"./CheckCircleFilled-Cp2-FAB3-1745663305082.js";import"./ExclamationCircleFilled-CnrITCO8-1745663305082.js";import"./InfoCircleFilled-xYJVfIFE-1745663305082.js";import"./ActionButton-OyCc6e4T-1745663305082.js";import"./Skeleton-DNWMcsdR-1745663305082.js";function F({selectedSupplier:n,onAddChemical:u}){const[p,l]=o.useState(""),[d,t]=o.useState(""),[h,m]=o.useState(null),[c,i]=o.useState([]),[g,f]=o.useState(!1),x=async s=>{if(s){f(!0);try{const a=await A.get(`/api/chemical/getChemicalByCategoryAndAlphabet?alphabet=${s}`);i(a.data)}catch(a){console.error("Error fetching chemicals:",a),i([])}finally{f(!1)}}},y=s=>{const a=s.target.value;l(a),a.trim()?(t(a),x(a.charAt(0))):(t(""),i([]))},[C,{isLoading:r}]=w(),S=s=>{m(s),l(s.name),t("")},j=async()=>{if(!h||!n){console.error("No chemical or supplier selected");return}try{const s=h._id,a=n._id;await C({supplierId:a,chemical_ids:[s]}).unwrap(),m(null),l(""),u&&u()}catch(s){alert(`Failed to add chemical: ${s.message||"Unknown error occurred"}`)}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:p,onChange:y,className:"w-full mb-4",disabled:!n}),g&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),d&&(c==null?void 0:c.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:c.map(s=>e.jsx("li",{onClick:()=>S(s),className:"p-2 hover:bg-gray-200 cursor-pointer border-b last:border-b-0",children:s.name},s._id))}),(c==null?void 0:c.length)===0&&!g&&d&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx(I,{onClick:j,disabled:r||!h||!n,className:`mt-4 w-fit py-2 bg-blue-500 text-white rounded hover:bg-blue-600 ${r?"opacity-50 cursor-not-allowed":""}`,children:r?"Adding...":"Add Chemical"})]})}function D({chemicals:n,refetch:u,supplierId:p,onRemoveChemical:l}){const[d,t]=o.useState(1),[h,m]=o.useState(10),[c]=_(),[i,g]=o.useState(null),[f,x]=o.useState(!1),y=a=>{g(a),x(!0)},C=async()=>{if(!(!p||!i))try{await c({supplierId:p,chemicalId:i._id}),l(i),u(),x(!1),g(null),j.length===1&&d>1&&t(1)}catch(a){console.error("Error removing chemical:",a)}};Math.ceil(n.length/h);const r=(d-1)*h,S=r+h,j=n.slice(r,S),s=[{title:"Action",dataIndex:"action",render:(a,b)=>e.jsx(R,{danger:!0,size:"small",onClick:()=>y(b),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(M,{dataSource:j,columns:s,rowKey:"_id",pagination:!1}),e.jsx(P,{current:d,total:n.length,pageSize:h,onChange:a=>t(a),showSizeChanger:!0,onShowSizeChange:(a,b)=>m(b),className:"mt-4 float-end pt-5"}),e.jsx(L,{title:"Confirm Deletion",open:f,onCancel:()=>x(!1),onOk:C,okText:"Delete",okButtonProps:{danger:!0},children:e.jsxs("p",{children:['Are you sure you want to delete "',i==null?void 0:i.name,'"?']})})]})}function E({onSelectSupplier:n}){const[u,p]=o.useState(""),[l,d]=o.useState(""),[t,h]=o.useState(null),{data:m,isLoading:c}=k(l.charAt(0),{skip:l.length===0}),{data:i,refetch:g,isFetching:f}=B(t==null?void 0:t._id,{skip:!t});o.useEffect(()=>{i&&!f&&(h(i),typeof n=="function"&&n(i))},[i,f,n]);const x=r=>{h(r),p(r.name),d(""),typeof n=="function"&&n(r)},y=r=>{const S=r.target.value;p(S),d(S)},C=()=>{g()};return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Supplier",value:u,onChange:y,className:"w-full mb-4"}),c?e.jsx("div",{children:"Loading..."}):l&&m&&m.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:m.map(r=>e.jsx("li",{onClick:()=>x(r),className:"p-2 hover:bg-gray-200 cursor-pointer",children:r.name},r.id))}),(m==null?void 0:m.length)===0&&!c&&l&&e.jsx("div",{className:"p-2 text-gray-500",children:"No Supplier found"}),f&&e.jsx("div",{className:"p-2 text-gray-500",children:"Refreshing supplier data..."}),e.jsx(F,{selectedSupplier:t,onAddChemical:C}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{chemicals:(t==null?void 0:t.chemical_ids)||[],refetch:g,onRemoveChemical:C,supplierId:t==null?void 0:t._id})})]})}function ae(){const[n,u]=v.useState(null),[p,l]=v.useState([]),d=t=>{u(t),l([])};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Supplier"}),e.jsx("div",{className:"space-y-4",children:e.jsx(E,{onSelectCustomer:d})})]})}export{ae as default};
