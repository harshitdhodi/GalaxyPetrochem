import{c as e,aY as s,g as a,b6 as t,j as l,I as i,B as c,X as d}from"./main-DbCIA5nM.js";import{b as r}from"./vendor-X2E3PIZN.js";import{b as m}from"./index.esm-Dk3WekSX.js";import{t as n,o,a as x,s as h,b as p}from"./index-CEYT__UF.js";import{S as j,a as u,b as y,c as b,d as g}from"./select-BGPtewlQ.js";import{C as f,a as N}from"./card-CgiS1VlC.js";import{R as v}from"./quill.snow-BtYlbvM3.js";import"./utils-ZFgnvnbw.js";import"./index-BoWlxZtN.js";import"./index-DPOpahcV.js";import"./check-DSfnMMtB.js";import"./chevron-up-D_C2ouKf.js";import"./isEqual-12EnfSUl.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=e("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),S=o({category:h().min(1,"Please select a category"),template:h().min(1,"Please select a template"),email:h().min(1,"To field is required").email("Invalid email format"),cc_email:p(h()).optional(),subject:h().min(1,"Subject is required"),body:h().min(1,"Body is required"),attachment:x().optional()});function C({defaultTo:e="",onSuccess:o}){const[x,h]=r.useState(!1),{data:p,isLoading:C}=s(),{data:F,isLoading:E}=a(),[_,{isLoading:k}]=t(),[T,q]=r.useState(null),[L,B]=r.useState([]),[P,z]=r.useState([]),{register:I,handleSubmit:V,formState:{errors:D},reset:H,watch:R,setValue:A}=m({resolver:n(S)}),G=R("category"),M=R("template"),U=R("body");r.useEffect((()=>{if(M&&F?.data){const e=F.data.find((e=>e._id===M));e&&(A("subject",e.subject),A("body",e.body))}}),[M,F,A]),r.useEffect((()=>{e&&A("email",e)}),[e,A]);return r.useEffect((()=>{if(G&&F?.data){const e=F.data.filter((e=>e.category?.emailCategory===G));z(e),A("template","")}}),[G,F,A]),l.jsx(f,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:l.jsx(N,{className:"p-6 overflow-y-auto",children:l.jsxs("form",{onSubmit:V((async e=>{const s=new FormData;s.append("email",e.email),s.append("cc_email",L),s.append("subject",e.subject),s.append("body",e.body),T&&s.append("attachment",T),h(!0);try{await _(s).unwrap(),alert("Email sent successfully!"),H(),q(null),B([]),o?.()}catch(a){alert("Failed to send email. Please try again.")}finally{h(!1)}})),className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),l.jsxs(j,{onValueChange:e=>A("category",e),children:[l.jsx(u,{id:"category",children:l.jsx(y,{placeholder:"Select Category"})}),l.jsx(b,{children:C?l.jsx(g,{disabled:!0,children:"Loading categories..."}):p&&p.length>0?p.map((e=>l.jsx(g,{value:e.emailCategory,children:e.emailCategory},e._id))):l.jsx(g,{disabled:!0,children:"No categories available"})})]}),D.category&&l.jsx("p",{className:"text-sm text-red-500",children:D.category.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),l.jsxs(j,{onValueChange:e=>A("template",e),disabled:!G,children:[l.jsx(u,{id:"template",children:l.jsx(y,{placeholder:G?"Select Email Template":"Please select a category first"})}),l.jsx(b,{children:E?l.jsx(g,{disabled:!0,children:"Loading templates..."}):0===P.length?l.jsx(g,{disabled:!0,children:"No templates in this category"}):P.map((e=>l.jsx(g,{value:e._id,children:e.name},e._id)))})]}),D.template&&l.jsx("p",{className:"text-sm text-red-500",children:D.template.message})]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),l.jsx(i,{id:"email",type:"text",placeholder:"Recipient email",...I("email"),"aria-invalid":D.email?"true":"false"}),D.email&&l.jsx("p",{className:"text-sm text-red-500",children:D.email.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),l.jsxs("div",{className:"relative",children:[l.jsx(i,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:e=>{var s;(s=e.target.value)&&!L.includes(s)&&B((e=>[...e,s])),e.target.value=""}}),L.length>0&&l.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:L.map(((e,s)=>l.jsxs("div",{className:"flex items-center justify-between py-1",children:[l.jsx("span",{className:"text-sm",children:e}),l.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{B((s=>s.filter(((s,a)=>a!==e))))})(s),children:l.jsx(d,{className:"h-3 w-3"})})]},s)))})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),l.jsx(i,{id:"subject",type:"text",placeholder:"Subject",...I("subject"),"aria-invalid":D.subject?"true":"false"}),D.subject&&l.jsx("p",{className:"text-sm text-red-500",children:D.subject.message})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),l.jsx(v,{value:U||"",onChange:e=>A("body",e),className:"bg-white"}),D.body&&l.jsx("p",{className:"text-sm text-red-500",children:D.body.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),l.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[l.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];q(s)},className:"hidden",id:"file-upload"}),l.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[l.jsx(w,{className:"mx-auto h-12 w-12 text-gray-400"}),l.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),T&&l.jsx("div",{className:"mt-2",children:l.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[l.jsx("span",{className:"text-sm truncate",children:T.name}),l.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>{q(null)},children:l.jsx(d,{className:"h-4 w-4"})})]})})]}),l.jsx(c,{type:"submit",className:"w-full",disabled:x||k,children:x||k?"Sending...":"Send Email"})]})})})}export{C as default};
//# sourceMappingURL=EmailForm-DATp2Ztc.js.map
