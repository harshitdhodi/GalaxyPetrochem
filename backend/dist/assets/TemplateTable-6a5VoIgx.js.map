{"version":3,"file":"TemplateTable-6a5VoIgx.js","sources":["../../src/email/template/TemplateTable.jsx"],"sourcesContent":["import React from \"react\";\r\nimport { useGetAllTemplatesQuery, useDeleteTemplateMutation } from \"@/slice/template/emailTemplate\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\n\r\nconst TemplateTable = () => {\r\n  const { data: apiResponse, error, isLoading } = useGetAllTemplatesQuery();\r\n  const [deleteTemplate] = useDeleteTemplateMutation();\r\n  const navigate = useNavigate();\r\n\r\n  // Handle different response formats\r\n  // If data is an array directly, use it\r\n  // If data is nested inside another object, try to find it\r\n  const templates = React.useMemo(() => {\r\n    if (!apiResponse) return [];\r\n    \r\n    // If apiResponse is an array, use it directly\r\n    if (Array.isArray(apiResponse)) {\r\n      return apiResponse;\r\n    }\r\n    \r\n    // If apiResponse has a 'data' property that's an array, use that\r\n    if (apiResponse.data && Array.isArray(apiResponse.data)) {\r\n      return apiResponse.data;\r\n    }\r\n    \r\n    // Look for any array property in the response\r\n    for (const key in apiResponse) {\r\n      if (Array.isArray(apiResponse[key])) {\r\n        return apiResponse[key];\r\n      }\r\n    }\r\n    \r\n    console.warn(\"Unexpected API response format:\", apiResponse);\r\n    return [];\r\n  }, [apiResponse]);\r\n\r\n  console.log(\"Processed templates:\", templates);\r\n\r\n  // State to track expanded rows\r\n  const [expandedRows, setExpandedRows] = React.useState({});\r\n\r\n  // Function to toggle row expansion\r\n  const toggleRowExpansion = (id) => {\r\n    setExpandedRows(prev => ({\r\n      ...prev,\r\n      [id]: !prev[id]\r\n    }));\r\n  };\r\n\r\n  // Function to truncate HTML text\r\n  const truncateText = (html, maxLength = 100) => {\r\n    if (!html) return '';\r\n    const strippedText = html.replace(/<[^>]+>/g, '');\r\n    if (strippedText.length <= maxLength) return html;\r\n    return strippedText.substring(0, maxLength) + '...';\r\n  };\r\n\r\n  if (isLoading) return <p>Loading templates...</p>;\r\n  if (error) return <p>Error loading templates: {error.message}</p>;\r\n  if (!templates.length) return <p>No templates found.</p>;\r\n\r\n  const handleEdit = (id) => {\r\n    navigate(`/edit-template/${id}`);\r\n  };\r\n\r\n  const handleDelete = async (id) => {\r\n    if (window.confirm(\"Are you sure you want to delete this template?\")) {\r\n      try {\r\n        await deleteTemplate(id).unwrap();\r\n        alert(\"Template deleted successfully!\");\r\n      } catch (error) {\r\n        alert(\"Failed to delete template: \" + (error.message || \"Unknown error\"));\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      <div className=\"flex justify-between items-center mb-4\">\r\n        <h1 className=\"text-xl font-bold\">Email Templates</h1>\r\n        <Link to=\"/add-template\">\r\n          <Button className=\"bg-[#3b1f91] text-white hover:bg-purple-700\" variant=\"primary\">\r\n            Add Template\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n      <hr className=\"mb-5\" />\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full border-collapse border border-gray-300\">\r\n          <thead>\r\n            <tr className=\"bg-gray-200\">\r\n              <th className=\"border border-gray-300 px-4 py-2\">Name</th>\r\n              <th className=\"border border-gray-300 px-4 py-2\">Subject</th>\r\n              <th className=\"border border-gray-300 px-4 py-2\">Body</th>\r\n              <th className=\"border border-gray-300 px-4 py-2\">Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {templates.map((template) => (\r\n              <tr key={template._id} className=\"hover:bg-gray-100\">\r\n                <td className=\"border border-gray-300 px-4 py-2\">\r\n                  {template.name || \"Unnamed Template\"}\r\n                </td>\r\n                <td className=\"border border-gray-300 px-4 py-2\">\r\n                  {template.subject || \"No Subject\"}\r\n                </td>\r\n                <td className=\"border border-gray-300 px-4 py-2\">\r\n                  <div\r\n                    dangerouslySetInnerHTML={{\r\n                      __html: expandedRows[template._id] \r\n                        ? template.body \r\n                        : truncateText(template.body)\r\n                    }}\r\n                  />\r\n                  {template.body && template.body.length > 100 && (\r\n                    <Button\r\n                      variant=\"link\"\r\n                      className=\"text-[#3b1f91] p-0 h-auto font-medium\"\r\n                      onClick={() => toggleRowExpansion(template._id)}\r\n                    >\r\n                      {expandedRows[template._id] ? 'Show Less' : 'Read More'}\r\n                    </Button>\r\n                  )}\r\n                </td>\r\n                <td className=\"border border-gray-300 px-4 py-2\">\r\n                  <div className=\"flex gap-2\">\r\n                    <Button \r\n                      variant=\"secondary\" \r\n                      className=\"hover:bg-[#4f359c]\" \r\n                      size=\"sm\" \r\n                      onClick={() => handleEdit(template._id)}\r\n                    >\r\n                      Edit\r\n                    </Button>\r\n                    <Button \r\n                      variant=\"destructive\" \r\n                      size=\"sm\" \r\n                      onClick={() => handleDelete(template._id)}\r\n                    >\r\n                      Delete\r\n                    </Button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      {templates.length === 0 && !isLoading && (\r\n        <div className=\"text-center py-4\">\r\n          <p>No templates found. Create your first template by clicking \"Add Template\".</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TemplateTable;"],"names":["TemplateTable","data","apiResponse","error","isLoading","useGetAllTemplatesQuery","deleteTemplate","useDeleteTemplateMutation","navigate","useNavigate","templates","React","useMemo","Array","isArray","key","expandedRows","setExpandedRows","useState","truncateText","html","maxLength","strippedText","replace","length","substring","jsx","children","jsxs","message","className","Link","to","Button","variant","map","template","name","subject","dangerouslySetInnerHTML","__html","_id","body","onClick","toggleRowExpansion","id","prev","size","handleEdit","async","window","confirm","unwrap","alert","handleDelete"],"mappings":"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"}