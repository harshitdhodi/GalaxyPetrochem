import{f as V,u as D,r as m,eb as O,ec as T,j as a,L as F,aA as A,g as Q}from"./index-CvpEAkJT-1746105294932.js";import{F as o}from"./index-D9BSnd30-1746105294932.js";import{B as n}from"./Breadcrumb-By17G_m8-1746105294932.js";import{R as k}from"./HomeOutlined-DQKjfUv6-1746105294932.js";import{S as L}from"./index-C5J9lWa--1746105294932.js";import{U as S,R as P}from"./index-CbPPwv9y-1746105294932.js";import{B as p}from"./index-HtlTYxit-1746105294932.js";import{I as g}from"./index-zCTvqLKZ-1746105294932.js";import{s as r}from"./index-Csc7Efds-1746105294932.js";import"./CheckCircleFilled-DiOqGQyU-1746105294932.js";import"./ExclamationCircleFilled-iqeS649A-1746105294932.js";import"./dropdown-DYgxBcL7-1746105294932.js";import"./EllipsisOutlined-uDsMLyN--1746105294932.js";import"./getAllowClear-BJhspl7D-1746105294932.js";import"./CheckOutlined-BJYqrfFS-1746105294932.js";import"./Input-CAgLNnFH-1746105294932.js";import"./DeleteOutlined-DsGCO7ir-1746105294932.js";import"./DownloadOutlined-Db9W_V9k-1746105294932.js";import"./TextArea-Ba21pJsH-1746105294932.js";import"./InfoCircleFilled-CqhREbuA-1746105294932.js";const{Option:G}=L,de=()=>{const{id:u}=V(),y=D(),[l]=o.useForm(),[d,B]=m.useState(!1),[h,w]=m.useState(!1),[C,b]=m.useState([]),{data:e,isLoading:E,refetch:U}=O(u),[q]=T();m.useEffect(()=>{(async()=>{try{const s=await Q.get("/api/menulist/get-menu");s.data.success&&b(s.data.data)}catch(s){console.error("Error fetching menu list:",s),r.error("Failed to fetch menu list")}})()},[]),m.useEffect(()=>{e&&l.setFieldsValue({title:e.title,altName:e.altName,details:e.details,imgName:e.imgName,pageSlug:e.pageSlug||"",image:e.image?[{name:e.imgName,url:`/api/image/download/${e.image}`}]:[],photo:e.photo?[{name:e.photoName,url:`/api/photo/download/${e.photo}`}]:[]})},[e,l]);const $=t=>{B(!0),l.setFieldsValue({imgName:t.file.name,image:t.fileList})},M=t=>{w(!0),l.setFieldsValue({photo:t.fileList})},R=async t=>{var s,c,f,x,j,N,I;try{if(!((s=t.title)!=null&&s.trim())){r.error("Title is required");return}if(!((c=t.altName)!=null&&c.trim())){r.error("Alt Name is required");return}if(!t.pageSlug){r.error("Page Slug is required");return}const i=new FormData;d&&((x=(f=t.image)==null?void 0:f[0])!=null&&x.originFileObj)?(i.append("image",t.image[0].originFileObj),i.append("imgName",t.image[0].name)):i.append("imgName",t.imgName||e.imgName),h&&((N=(j=t.photo)==null?void 0:j[0])!=null&&N.originFileObj)?i.append("photo",t.photo[0].originFileObj):e.photo&&i.append("photo",e.photo),i.append("title",t.title.trim()),i.append("altName",t.altName.trim()),i.append("details",((I=t.details)==null?void 0:I.trim())||""),i.append("pageSlug",t.pageSlug),await q({id:u,bannerData:i}),r.success("Banner updated successfully"),U(),y("/banner-table")}catch(i){console.error(i),r.error("Failed to update banner")}};return E?a.jsx("div",{children:"Loading..."}):a.jsxs("div",{children:[a.jsxs(n,{style:{padding:"16px 24px"},children:[a.jsx(n.Item,{children:a.jsxs(F,{to:"/dashboard",children:[a.jsx(k,{})," Dashboard"]})}),a.jsx(n.Item,{children:a.jsx(F,{to:"/banner-table",children:"Banner Management"})}),a.jsx(n.Item,{children:"Edit Banner"})]}),a.jsxs("div",{style:{padding:"24px"},children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Edit Banner"}),a.jsxs(o,{form:l,layout:"vertical",onFinish:R,initialValues:{title:(e==null?void 0:e.title)||"",altName:(e==null?void 0:e.altName)||"",details:(e==null?void 0:e.details)||"",imgName:(e==null?void 0:e.imgName)||"",pageSlug:(e==null?void 0:e.pageSlug)||"",image:e!=null&&e.image?[{name:e.imgName,url:`/api/image/download/${e.image}`}]:[],photo:e!=null&&e.photo?[{name:e.photoName,url:`/api/image/download/${e.photo}`}]:[]},children:[a.jsx(o.Item,{name:"pageSlug",label:"Page Slug",rules:[{required:!0,message:"Please select a Page Slug!"}],children:a.jsx(L,{placeholder:"Select Page Slug",children:C.map(t=>a.jsx(G,{value:t.parent.path,children:t.parent.name},t._id))})}),a.jsx(o.Item,{name:"image",label:"Banner Image",valuePropName:"fileList",getValueFromEvent:t=>t&&t.fileList,children:a.jsx(S,{maxCount:1,listType:"picture",beforeUpload:()=>!1,onChange:$,defaultFileList:e!=null&&e.image?[{name:e.imgName,url:`/api/image/download/${e.image}`}]:[],children:a.jsx(p,{icon:a.jsx(P,{}),children:d?"Change Image":"Upload New Image"})})}),a.jsx(o.Item,{name:"photo",label:"Photo",valuePropName:"fileList",getValueFromEvent:t=>t&&t.fileList,children:a.jsx(S,{maxCount:1,listType:"picture",beforeUpload:()=>!1,onChange:M,defaultFileList:e!=null&&e.photo?[{name:e.photoName,url:`/api/photo/download/${e.photo}`}]:[],children:a.jsx(p,{icon:a.jsx(P,{}),children:h?"Change Photo":"Upload New Photo"})})}),a.jsx(o.Item,{name:"imgName",label:"Image Name",rules:[{required:!0,message:"Please input image name!"}],children:a.jsx(g,{disabled:d})}),a.jsx(o.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please input title!"}],children:a.jsx(g,{})}),a.jsx(o.Item,{name:"altName",label:"Alt Name",rules:[{required:!0,message:"Please input alt name!"}],children:a.jsx(g,{})}),a.jsx(o.Item,{name:"details",label:"Details",rules:[{message:"Please input details!"}],children:a.jsx(A,{theme:"snow"})}),a.jsx(o.Item,{children:a.jsx(p,{type:"primary",htmlType:"submit",children:"Update"})})]})]})]})};export{de as default};
