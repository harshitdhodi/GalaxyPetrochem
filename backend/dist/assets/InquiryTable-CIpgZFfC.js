import{c as e,dd as s,ae as a,j as t,ai as l,ak as i,al as n,am as r,aE as d,I as c,B as o,de as m,df as x,dg as h,dh as j,aj as u,af as g,di as p,dj as f,P as N,T as w,e as v,f as C,g as y,h as S,i as b}from"./main-CzSo-TQq.js";import{b as k,L as F}from"./vendor-BCMiqwDy.js";import{S as E,c as I,d as L,a as U,b as D}from"./select-v0vOS5HG.js";import{F as A}from"./Table-C-n2--3-.js";import{M as O}from"./index-CxFUZGYS.js";import{R as _}from"./EditOutlined-nN6QtEy1.js";import{R as T}from"./DeleteOutlined-BWd8Mtlr.js";import{T as P}from"./textarea-DYE5AoRU.js";import{B as $}from"./badge-drzyMCJ6.js";import{D as M,a as q,b as z,c as V}from"./dropdown-menu-DmD2_E8Q.js";import{C as Y}from"./checkbox-B8rDcY9L.js";import B from"./EmailForm-B84EVkC-.js";import{E as H}from"./ellipsis-vertical-BKj02QtP.js";import"./utils-ZFgnvnbw.js";import"./index-C6jzH1EM.js";import"./index-prcspqn7.js";import"./check-BBACUXZH.js";import"./chevron-up-BeGHc2Vw.js";import"./index-DSpNpUBy.js";import"./styleChecker-CytH8GIy.js";import"./index-B7eE-GBL.js";import"./EllipsisOutlined-BfcsApT3.js";import"./dropdown-Dz-q1Mre.js";import"./getAllowClear-CUuit-6u.js";import"./CheckOutlined-Cn3WkZbn.js";import"./Input-dXXm4f2Q.js";import"./index-BJFDSJ5H.js";import"./index-D5p0e1mK.js";import"./CheckCircleFilled-ReswMhjZ.js";import"./ExclamationCircleFilled-xRTYYEFC.js";import"./InfoCircleFilled-CAKYzuNC.js";import"./ActionButton-B_-XN75h.js";import"./Skeleton-DRGMwVq6.js";import"./chevron-right-BuWKzX76.js";import"./index.esm-nvYjwl0o.js";import"./index-DNG4Sede.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=e("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function G({followUps:e,onEdit:l,onDelete:i,currentPage:n,totalPages:r,onPageChange:d}){const[c,o]=k.useState(!1),[m,x]=k.useState(null),[h]=s(),{refetch:j}=a(),u=(e,s)=>{(async(e,s)=>{try{await h({id:e,...s}).unwrap(),await j()}catch(a){}})(e,{status:s})},g=[{title:"Date",dataIndex:"date",key:"date",render:e=>new Date(e).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(e,s)=>t.jsxs("select",{value:e||"New",onChange:e=>u(s._id,e.target.value),className:"border rounded px-2 py-1",children:[t.jsx("option",{value:"New",children:"New"}),t.jsx("option",{value:"In Progress",children:"In Progress"}),t.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(e,s)=>t.jsxs("div",{className:"flex gap-4 ",children:[t.jsx(_,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>l(s._id)}),t.jsx(T,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>{return e=s._id,x(e),void o(!0);var e}})]})}];return t.jsxs(t.Fragment,{children:[t.jsx(A,{columns:g,dataSource:e,rowKey:"_id",pagination:{current:n,total:10*r,onChange:d}}),t.jsx(O,{title:"Confirm Delete",open:c,onOk:async()=>{m&&(await i(m),await j(),1===e.length&&n>1?d(n-1):j(),o(!1),x(null))},onCancel:()=>o(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:t.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function J({isOpen:e,onClose:s,onAddFollowUp:a}){const[m,x]=k.useState({date:"",message:""});return t.jsx(l,{open:e,onOpenChange:s,children:t.jsxs(i,{className:"sm:max-w-[425px]",children:[t.jsx(n,{children:t.jsx(r,{children:"Add Follow Up"})}),t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"date",className:"text-right",children:"Date"}),t.jsx(c,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:m.date?new Date(m.date).toISOString().slice(0,10):"",onChange:e=>x({...m,date:e.target.value})})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"message",className:"text-right",children:"Message"}),t.jsx(P,{id:"message",value:m.message,onChange:e=>x({...m,message:e.target.value}),className:"col-span-3"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(o,{className:"bg-red-600",variant:"outline",onClick:s,children:"Cancel"}),t.jsx(o,{onClick:()=>{a(m),x({date:"",message:""})},children:"Add"})]})]})})}function K({isOpen:e,onClose:a,followUpId:x,onSave:h}){const[j,u]=k.useState({date:"",message:""}),{data:g,isLoading:p,error:f}=m(x,{skip:!e||!x}),[N,{isLoading:w,error:v}]=s();k.useEffect((()=>{if(g){u({date:(e=>{const s=new Date(e);return`${String(s.getMonth()+1).padStart(2,"0")}/${String(s.getDate()).padStart(2,"0")}/${s.getFullYear()}`})(g?.data?.date||""),message:g?.data?.message||""})}}),[g]);return k.useEffect((()=>{f&&alert(`Fetch Error: ${f.message}`),v&&alert(`Update Error: ${v.message}`)}),[f,v]),e?t.jsx(l,{open:e,onOpenChange:a,children:t.jsxs(i,{className:"sm:max-w-[425px]",children:[t.jsx(n,{children:t.jsx(r,{children:"Edit Follow Up"})}),p?t.jsx("div",{children:"Loading..."}):t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-date",className:"text-right",children:"Date"}),t.jsx(c,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:j.date,onChange:e=>u({...j,date:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-message",className:"text-right",children:"Message"}),t.jsx(P,{id:"edit-message",value:j.message,onChange:e=>u({...j,message:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(o,{variant:"outline",onClick:a,disabled:w,className:"bg-red-600",children:"Cancel"}),t.jsxs(o,{onClick:async()=>{if(j.date)if(j.message)try{await N({message:j.message,date:new Date(j.date).toISOString().split("T")[0],id:x}).unwrap();h({...g?.data,date:j.date,message:j.message}),a()}catch(e){alert(`Update failed: ${e.message||"Unknown error"}`)}else alert("Please enter a message.");else alert("Please select a date.")},disabled:w,children:[t.jsx(R,{className:"mr-2 h-4 w-4"})," ",w?"Saving...":"Save"]})]})]})]})}):null}function X({inquiry:e,onFollowUpAdded:s}){const[a,d]=k.useState(!1),[c,m]=k.useState(!1),[g,p]=k.useState(!1),[f,N]=k.useState(null),[w,v]=k.useState(1),{data:C,error:y,isLoading:S,refetch:b}=x(e._id);k.useEffect((()=>{}),[y]);const F=C?.data||[],E=F.length,I=Math.ceil(E/5),L=5*w,U=L-5,D=F.slice(U,L),[A,{isLoading:O}]=h(),[_,{isLoading:T}]=j();return t.jsxs(t.Fragment,{children:[t.jsxs(l,{open:a,onOpenChange:e=>{d(e),e&&b()},children:[t.jsx(u,{asChild:!0,children:t.jsxs(o,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",t.jsx($,{variant:"outline",className:"bg-[#ffffff] text-black",children:E})]})}),t.jsx(i,{className:"sm:max-w-[60%] h-auto",children:t.jsxs("div",{className:"grid gap-4",children:[t.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[t.jsx(n,{children:t.jsxs(r,{children:["Follow Up - ",e.firstName," ",e.lastName]})}),t.jsx(o,{onClick:()=>m(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),t.jsx(G,{followUps:D,onEdit:e=>{N(e),p(!0)},onDelete:async a=>{try{await _(a).unwrap(),b(),s(e,E-1)}catch(t){}},currentPage:w,totalPages:I,onPageChange:e=>{e>0&&e<=I&&v(e)}})]})})]}),t.jsx(J,{isOpen:c,onClose:()=>m(!1),onAddFollowUp:async a=>{if(a.date&&a.message){const l={inquiryId:e._id,date:a.date,message:a.message};try{await A(l).unwrap(),b(),s(e,E+1),m(!1)}catch(t){}}}}),t.jsx(K,{isOpen:g,onClose:()=>p(!1),followUpId:f,onSave:()=>{b(),p(!1)}})]})}function Z(){const{data:e=[],isLoading:s,isError:a}=g(),[d,m]=k.useState(15),[x,h]=k.useState(e),[j]=p(),{data:u,isLoading:A}=f(),[_,T]=k.useState(""),[P,$]=k.useState(null),[R,G]=k.useState(null),[J,K]=k.useState(null),[Z,Q]=k.useState(""),[W,ee]=k.useState(""),[se,ae]=k.useState(""),[te,le]=k.useState([]),[ie,ne]=k.useState(!1),re=e.filter((e=>(""===_||e.organisation.toLowerCase().includes(_.toLowerCase()))&&(null===P||e.status===P)&&(null===R||e.source===R)&&(null===J||`${e.firstName} ${e.lastName}`.toLowerCase().includes(J.toLowerCase()))&&(""===Z||e.email.toLowerCase().includes(Z.toLowerCase()))&&(""===W||e.phone.toLowerCase().includes(W.toLowerCase())))),de=re?.filter((e=>te.includes(e._id)))?.map((e=>e.email))?.join(", "),ce=(e,s)=>{h((a=>a.map((a=>a.companyName===e.companyName?{...a,totalTasks:s}:a))))};return t.jsxs("div",{className:"p-4",children:[te.length>0&&t.jsx("div",{className:"mb-4",children:t.jsxs(o,{onClick:()=>ne(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",te.length,")"]})}),t.jsx(l,{open:ie,onOpenChange:ne,children:t.jsxs(i,{className:"max-w-4xl",children:[t.jsx(n,{children:t.jsx(r,{children:"Send Email to Selected Inquiries"})}),t.jsx(B,{defaultTo:de,onSuccess:()=>{ne(!1),le([])}})]})}),t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),t.jsx(F,{to:"/add-inquiry",children:t.jsxs(o,{className:"gap-2",children:[t.jsx(N,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),t.jsxs(w,{className:"border",children:[t.jsxs(v,{children:[t.jsxs(C,{className:"border-b bg-gray-100",children:[t.jsx(y,{className:"w-12"}),t.jsx(y,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),t.jsx(y,{className:"text-left",children:"Info"}),t.jsx(y,{className:"text-left",children:"Message"}),t.jsx(y,{className:"text-left",children:"Follow Up"}),t.jsx(y,{className:"w-[80px] text-left",children:"Actions"})]}),t.jsxs(C,{className:"border-b",children:[t.jsx(y,{}),t.jsx(y,{}),t.jsx(y,{children:t.jsx(c,{placeholder:"Search Info",className:"w-[200px]",value:J||"",onChange:e=>K(e.target.value)})}),t.jsx(y,{children:t.jsx(E,{value:P||"reset",onValueChange:e=>$("reset"===e?null:e),children:t.jsxs(I,{children:[t.jsx(L,{value:"reset",children:"All Statuses"}),u?.data?.map((e=>t.jsx(L,{value:e.status,children:e.status},e._id)))]})})}),t.jsx(y,{}),t.jsx(y,{})]})]}),t.jsx(S,{children:re.map(((e,s)=>t.jsxs(C,{className:"border-b",children:[t.jsx(b,{className:"p-5",children:t.jsx(Y,{checked:te.includes(e._id),onCheckedChange:()=>{return s=e._id,void le((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),t.jsx(b,{className:"sticky left-0 bg-background",children:e.createdAt.slice(0,10)}),t.jsx(b,{children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"font-medium",children:[e.firstName," ",e.lastName,","]}),e.organisation," ,",t.jsx("div",{className:"text-sm text-muted-foreground",children:e.email}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.phone," â€¢ ",e.address]})]})}),t.jsx(b,{children:e.message}),t.jsx(b,{className:"text-left",children:t.jsx(X,{inquiry:e,onFollowUpAdded:ce})}),t.jsx(b,{className:"text-center",children:t.jsxs(M,{children:[t.jsx(q,{asChild:!0,children:t.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:t.jsx(H,{className:"h-4 w-4"})})}),t.jsxs(z,{align:"end",className:"w-[160px]",children:[t.jsx(F,{to:`/edit-inquiry/${e._id}`,children:t.jsx(V,{children:"Edit"})}),t.jsx(V,{onClick:()=>(async e=>{O.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await j(e),h((s=>s.filter((s=>s._id!==e))))}catch(s){}}})})(e._id),children:"Delete"})]})]})})]},s)))})]}),t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm",children:"Items per page:"}),t.jsxs(E,{value:d.toString(),onValueChange:e=>m(Number(e)),children:[t.jsx(U,{className:"w-[70px]",children:t.jsx(D,{children:d})}),t.jsxs(I,{children:[t.jsx(L,{value:"15",children:"15"}),t.jsx(L,{value:"25",children:"25"}),t.jsx(L,{value:"50",children:"50"}),t.jsx(L,{value:"100",children:"100"})]})]})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(d,re.length)} of ${re.length}`})]})]})}export{Z as default};
//# sourceMappingURL=InquiryTable-CIpgZFfC.js.map
