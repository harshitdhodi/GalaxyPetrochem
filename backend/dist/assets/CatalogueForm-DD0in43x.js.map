{"version":3,"file":"CatalogueForm-DD0in43x.js","sources":["../../src/websiteBackend/catalogue/CatalogueForm.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Form, Input, Button, Upload, message, Breadcrumb } from 'antd';\r\nimport { UploadOutlined } from '@ant-design/icons';\r\nimport { useCreateCatalogueMutation, \r\n     useGetCatalogueByIdQuery, useUpdateCatalogueMutation } from \"@/slice/catalogue/catalogueslice\";\r\nimport { useNavigate, useParams, Link } from 'react-router-dom';\r\n\r\nconst CatalogueForm = () => {\r\n  const [form] = Form.useForm();\r\n  const navigate = useNavigate();\r\n  const { id } = useParams();\r\n  const { data: catalogue, isLoading: isFetching } = useGetCatalogueByIdQuery(id, { skip: !id });\r\n  const [createCatalogue] = useCreateCatalogueMutation();\r\n  const [updateCatalogue] = useUpdateCatalogueMutation();\r\n  const [fileList, setFileList] = useState([]);\r\n  const [imageList, setImageList] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (catalogue) {\r\n      form.setFieldsValue(catalogue);\r\n      setFileList([{ url: `/api/image/pdf/view/${catalogue.catalogue}`, name: catalogue.catalogue }]);\r\n      setImageList([{ url: `/api/image/view/${catalogue.image}`, name: catalogue.image }]);\r\n    }\r\n  }, [catalogue, form]);\r\n\r\n  const handleFinish = async (values) => {\r\n    const formData = new FormData();\r\n    formData.append('title', values.title);\r\n    if (fileList[0]?.originFileObj) {\r\n      formData.append('catalog', fileList[0].originFileObj); // Updated field name to 'catalog'\r\n    }\r\n    if (imageList[0]?.originFileObj) {\r\n      formData.append('image', imageList[0].originFileObj); // Added field name 'image'\r\n    }\r\n\r\n    try {\r\n      if (id) {\r\n        await updateCatalogue({ id, formData }).unwrap();\r\n        message.success('Catalogue updated successfully');\r\n      } else {\r\n        await createCatalogue(formData).unwrap();\r\n        message.success('Catalogue created successfully');\r\n      }\r\n      navigate('/catalogue-table');\r\n    } catch (error) {\r\n      message.error('Failed to save catalogue');\r\n    }\r\n  };\r\n\r\n  const handleFileChange = ({ fileList }) => setFileList(fileList);\r\n  const handleImageChange = ({ fileList }) => setImageList(fileList);\r\n\r\n  return (\r\n    <>\r\n      <Breadcrumb style={{ marginBottom: '16px' }}>\r\n        <Breadcrumb.Item>\r\n          <Link to=\"/dashboard\">Dashboard</Link>\r\n        </Breadcrumb.Item>\r\n        <Breadcrumb.Item>\r\n          <Link to=\"/catalogue-table\">Catalogue Table</Link>\r\n        </Breadcrumb.Item>\r\n        <Breadcrumb.Item>{id ? 'Edit Catalogue' : 'Create Catalogue'}</Breadcrumb.Item>\r\n      </Breadcrumb>\r\n      <Form form={form} layout=\"vertical\" onFinish={handleFinish}>\r\n        <Form.Item name=\"title\" label=\"Title\" rules={[{ required: true, message: 'Please enter the title' }]}>\r\n          <Input />\r\n        </Form.Item>\r\n        <Form.Item name=\"catalogue\" label=\"Catalogue\" rules={[{ required: true, message: 'Please upload a catalogue' }]}>\r\n          <Upload\r\n            listType=\"picture\"\r\n            maxCount={1}\r\n            fileList={fileList}\r\n            beforeUpload={() => false}\r\n            onChange={handleFileChange}\r\n          >\r\n            <Button icon={<UploadOutlined />}>Upload Catalogue</Button>\r\n          </Upload>\r\n        </Form.Item>\r\n        <Form.Item name=\"image\" label=\"Image\" rules={[{ required: true, message: 'Please upload an image' }]}>\r\n          <Upload\r\n            listType=\"picture\"\r\n            maxCount={1}\r\n            fileList={imageList}\r\n            beforeUpload={() => false}\r\n            onChange={handleImageChange}\r\n          >\r\n            <Button icon={<UploadOutlined />}>Upload Image</Button>\r\n          </Upload>\r\n        </Form.Item>\r\n        <Form.Item>\r\n          <Button type=\"primary\" htmlType=\"submit\" loading={isFetching}>\r\n            {id ? 'Update' : 'Create'}\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CatalogueForm;"],"names":["CatalogueForm","form","Form","useForm","navigate","useNavigate","id","useParams","data","catalogue","isLoading","isFetching","useGetCatalogueByIdQuery","skip","createCatalogue","useCreateCatalogueMutation","updateCatalogue","useUpdateCatalogueMutation","fileList","setFileList","useState","imageList","setImageList","useEffect","setFieldsValue","url","name","image","jsxs","Fragment","children","Breadcrumb","style","marginBottom","jsx","Item","Link","to","layout","onFinish","async","values","formData","FormData","append","title","originFileObj","unwrap","message","success","error","label","rules","required","Input","Upload","listType","maxCount","beforeUpload","onChange","Button","icon","UploadOutlined","type","htmlType","loading"],"mappings":"uyBAOA,MAAMA,EAAgB,KACpB,MAAOC,GAAQC,EAAKC,UACdC,EAAWC,KACXC,GAAEA,GAAOC,KACPC,KAAMC,EAAWC,UAAWC,GAAeC,EAAyBN,EAAI,CAAEO,MAAOP,KAClFQ,GAAmBC,KACnBC,GAAmBC,KACnBC,EAAUC,GAAeC,EAAAA,SAAS,KAClCC,EAAWC,GAAgBF,EAAAA,SAAS,IAE3CG,EAAAA,WAAU,KACJd,IACFR,EAAKuB,eAAef,GACRU,EAAA,CAAC,CAAEM,IAAK,uBAAuBhB,EAAUA,YAAaiB,KAAMjB,EAAUA,aACrEa,EAAA,CAAC,CAAEG,IAAK,mBAAmBhB,EAAUkB,QAASD,KAAMjB,EAAUkB,SAAQ,GAEpF,CAAClB,EAAWR,IA6Bf,OAEI2B,EAAAA,KAAAC,WAAA,CAAAC,SAAA,CAAAF,EAAAA,KAACG,EAAW,CAAAC,MAAO,CAAEC,aAAc,QACjCH,SAAA,CAACI,EAAAA,IAAAH,EAAWI,KAAX,CACCL,SAAAI,EAAAA,IAACE,GAAKC,GAAG,aAAaP,yBAExBI,EAAAA,IAACH,EAAWI,KAAX,CACCL,eAACM,EAAK,CAAAC,GAAG,mBAAmBP,SAAA,4BAE7BC,EAAWI,KAAX,CAAiBL,SAAAxB,EAAK,iBAAmB,+BAE3CJ,EAAK,CAAAD,OAAYqC,OAAO,WAAWC,SAtCnBC,MAAOC,IACpB,MAAAC,EAAW,IAAIC,SACZD,EAAAE,OAAO,QAASH,EAAOI,OAC5B3B,EAAS,IAAI4B,eACfJ,EAASE,OAAO,UAAW1B,EAAS,GAAG4B,eAErCzB,EAAU,IAAIyB,eAChBJ,EAASE,OAAO,QAASvB,EAAU,GAAGyB,eAGpC,IACExC,SACIU,EAAgB,CAAEV,KAAIoC,aAAYK,SACxCC,EAAQC,QAAQ,0CAEVnC,EAAgB4B,GAAUK,SAChCC,EAAQC,QAAQ,mCAElB7C,EAAS,0BACF8C,GACPF,EAAQE,MAAM,2BAA0B,GAmBtCpB,SAAA,CAAAI,MAAChC,EAAKiC,KAAL,CAAUT,KAAK,QAAQyB,MAAM,QAAQC,MAAO,CAAC,CAAEC,UAAU,EAAML,QAAS,2BACvElB,SAAAI,MAACoB,GAAM,WAERpD,EAAKiC,KAAL,CAAUT,KAAK,YAAYyB,MAAM,YAAYC,MAAO,CAAC,CAAEC,UAAU,EAAML,QAAS,8BAC/ElB,SAAAI,EAAAA,IAACqB,EAAA,CACCC,SAAS,UACTC,SAAU,EACVvC,WACAwC,aAAc,KAAM,EACpBC,SAxBe,EAAGzC,SAAAA,KAAeC,EAAYD,GA0B7CY,eAAC8B,EAAO,CAAAC,KAAO3B,MAAA4B,EAAA,CAAe,GAAIhC,SAAgB,+BAGrD5B,EAAKiC,KAAL,CAAUT,KAAK,QAAQyB,MAAM,QAAQC,MAAO,CAAC,CAAEC,UAAU,EAAML,QAAS,2BACvElB,SAAAI,EAAAA,IAACqB,EAAA,CACCC,SAAS,UACTC,SAAU,EACVvC,SAAUG,EACVqC,aAAc,KAAM,EACpBC,SAlCgB,EAAGzC,SAAAA,KAAeI,EAAaJ,GAoC/CY,eAAC8B,EAAO,CAAAC,KAAO3B,MAAA4B,EAAA,CAAe,GAAIhC,SAAY,qBAGjDI,EAAAA,IAAAhC,EAAKiC,KAAL,CACCL,eAAC8B,EAAO,CAAAG,KAAK,UAAUC,SAAS,SAASC,QAAStD,EAC/CmB,SAAKxB,EAAA,SAAW,kBAIzB"}