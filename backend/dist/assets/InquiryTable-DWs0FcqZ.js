import{c as e,a$ as s,d as a,j as t,D as l,k as i,l as n,m as r,L as d,I as o,B as c,b0 as m,b1 as x,b2 as h,b3 as j,h as u,e as p,b4 as g,b5 as f,P as N}from"./main-DbCIA5nM.js";import{b as w,L as v}from"./vendor-X2E3PIZN.js";import{S as y,c as C,d as b,a as S,b as k}from"./select-BGPtewlQ.js";import{T as F,a as L,b as I,c as E,d as A,e as D}from"./table-DVNdpQ_I.js";import{F as U}from"./Table-DuH0XXff.js";import{M as O}from"./index-s4gvY70H.js";import{R as _}from"./EditOutlined-_U-8X4qF.js";import{R as T}from"./DeleteOutlined-D5hKN4qo.js";import{T as $}from"./textarea-uyS90DRv.js";import{B as q}from"./badge-uBIQGIZ4.js";import{D as P,a as M,b as V,c as z}from"./dropdown-menu-C0TLOZFq.js";import{C as B}from"./checkbox-B4CvUtyY.js";import H from"./EmailForm-DATp2Ztc.js";import{E as R}from"./ellipsis-vertical-BYn5zANP.js";import"./utils-ZFgnvnbw.js";import"./index-BoWlxZtN.js";import"./index-DPOpahcV.js";import"./check-DSfnMMtB.js";import"./chevron-up-D_C2ouKf.js";import"./objectSpread2-C2mPdFQ-.js";import"./index-CvhnQ2ZS.js";import"./AntdIcon-Bc_RgQsY.js";import"./toArray-DIarnBRF.js";import"./addEventListener-Dm19rJS7.js";import"./index-TlfG7RwS.js";import"./index-Cie-PtDs.js";import"./dropdown-C2Lyn6ws.js";import"./getAllowClear-CF0z5FWe.js";import"./CheckOutlined-qoM0f-f3.js";import"./Input-DzV7KJ8a.js";import"./index-DKxChPud.js";import"./index-CoLLPh3Y.js";import"./CheckCircleFilled-vSnFSXRd.js";import"./ExclamationCircleFilled-jOtwz4nB.js";import"./InfoCircleFilled-BiVI0bqr.js";import"./ActionButton-9gw_uhHA.js";import"./index-CjgsjwJv.js";import"./index-BJvm14ET.js";import"./fade-CZ8b_ilM.js";import"./Skeleton-Ds91yGkQ.js";import"./chevron-right-BX1oQPFZ.js";import"./index.esm-Dk3WekSX.js";import"./index-CEYT__UF.js";import"./card-CgiS1VlC.js";import"./quill.snow-BtYlbvM3.js";import"./isEqual-12EnfSUl.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=e("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function G({followUps:e,onEdit:l,onDelete:i,currentPage:n,totalPages:r,onPageChange:d}){const[o,c]=w.useState(!1),[m,x]=w.useState(null),[h]=s(),{refetch:j}=a(),u=(e,s)=>{(async(e,s)=>{try{await h({id:e,...s}).unwrap(),await j()}catch(a){}})(e,{status:s})},p=[{title:"Date",dataIndex:"date",key:"date",render:e=>new Date(e).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(e,s)=>t.jsxs("select",{value:e||"New",onChange:e=>u(s._id,e.target.value),className:"border rounded px-2 py-1",children:[t.jsx("option",{value:"New",children:"New"}),t.jsx("option",{value:"In Progress",children:"In Progress"}),t.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(e,s)=>t.jsxs("div",{className:"flex gap-4 ",children:[t.jsx(_,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>l(s._id)}),t.jsx(T,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>{return e=s._id,x(e),void c(!0);var e}})]})}];return t.jsxs(t.Fragment,{children:[t.jsx(U,{columns:p,dataSource:e,rowKey:"_id",pagination:{current:n,total:10*r,onChange:d}}),t.jsx(O,{title:"Confirm Delete",open:o,onOk:async()=>{m&&(await i(m),await j(),1===e.length&&n>1?d(n-1):j(),c(!1),x(null))},onCancel:()=>c(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:t.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function K({isOpen:e,onClose:s,onAddFollowUp:a}){const[m,x]=w.useState({date:"",message:""});return t.jsx(l,{open:e,onOpenChange:s,children:t.jsxs(i,{className:"sm:max-w-[425px]",children:[t.jsx(n,{children:t.jsx(r,{children:"Add Follow Up"})}),t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"date",className:"text-right",children:"Date"}),t.jsx(o,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:m.date?new Date(m.date).toISOString().slice(0,10):"",onChange:e=>x({...m,date:e.target.value})})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"message",className:"text-right",children:"Message"}),t.jsx($,{id:"message",value:m.message,onChange:e=>x({...m,message:e.target.value}),className:"col-span-3"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(c,{className:"bg-red-600",variant:"outline",onClick:s,children:"Cancel"}),t.jsx(c,{onClick:()=>{a(m),x({date:"",message:""})},children:"Add"})]})]})})}function Q({isOpen:e,onClose:a,followUpId:x,onSave:h}){const[j,u]=w.useState({date:"",message:""}),{data:p,isLoading:g,error:f}=m(x,{skip:!e||!x}),[N,{isLoading:v,error:y}]=s();w.useEffect((()=>{if(p){u({date:(e=>{const s=new Date(e);return`${String(s.getMonth()+1).padStart(2,"0")}/${String(s.getDate()).padStart(2,"0")}/${s.getFullYear()}`})(p?.data?.date||""),message:p?.data?.message||""})}}),[p]);return w.useEffect((()=>{f&&alert(`Fetch Error: ${f.message}`),y&&alert(`Update Error: ${y.message}`)}),[f,y]),e?t.jsx(l,{open:e,onOpenChange:a,children:t.jsxs(i,{className:"sm:max-w-[425px]",children:[t.jsx(n,{children:t.jsx(r,{children:"Edit Follow Up"})}),g?t.jsx("div",{children:"Loading..."}):t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-date",className:"text-right",children:"Date"}),t.jsx(o,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:j.date,onChange:e=>u({...j,date:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-message",className:"text-right",children:"Message"}),t.jsx($,{id:"edit-message",value:j.message,onChange:e=>u({...j,message:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(c,{variant:"outline",onClick:a,disabled:v,className:"bg-red-600",children:"Cancel"}),t.jsxs(c,{onClick:async()=>{if(j.date)if(j.message)try{await N({message:j.message,date:new Date(j.date).toISOString().split("T")[0],id:x}).unwrap();h({...p?.data,date:j.date,message:j.message}),a()}catch(e){alert(`Update failed: ${e.message||"Unknown error"}`)}else alert("Please enter a message.");else alert("Please select a date.")},disabled:v,children:[t.jsx(Y,{className:"mr-2 h-4 w-4"})," ",v?"Saving...":"Save"]})]})]})]})}):null}function W({inquiry:e,onFollowUpAdded:s}){const[a,d]=w.useState(!1),[o,m]=w.useState(!1),[p,g]=w.useState(!1),[f,N]=w.useState(null),[v,y]=w.useState(1),{data:C,error:b,isLoading:S,refetch:k}=x(e._id);w.useEffect((()=>{}),[b]);const F=C?.data||[],L=F.length,I=Math.ceil(L/5),E=5*v,A=E-5,D=F.slice(A,E),[U,{isLoading:O}]=h(),[_,{isLoading:T}]=j();return t.jsxs(t.Fragment,{children:[t.jsxs(l,{open:a,onOpenChange:e=>{d(e),e&&k()},children:[t.jsx(u,{asChild:!0,children:t.jsxs(c,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",t.jsx(q,{variant:"outline",className:"bg-[#ffffff] text-black",children:L})]})}),t.jsx(i,{className:"sm:max-w-[60%] h-auto",children:t.jsxs("div",{className:"grid gap-4",children:[t.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[t.jsx(n,{children:t.jsxs(r,{children:["Follow Up - ",e.firstName," ",e.lastName]})}),t.jsx(c,{onClick:()=>m(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),t.jsx(G,{followUps:D,onEdit:e=>{N(e),g(!0)},onDelete:async a=>{try{await _(a).unwrap(),k(),s(e,L-1)}catch(t){}},currentPage:v,totalPages:I,onPageChange:e=>{e>0&&e<=I&&y(e)}})]})})]}),t.jsx(K,{isOpen:o,onClose:()=>m(!1),onAddFollowUp:async a=>{if(a.date&&a.message){const l={inquiryId:e._id,date:a.date,message:a.message};try{await U(l).unwrap(),k(),s(e,L+1),m(!1)}catch(t){}}}}),t.jsx(Q,{isOpen:p,onClose:()=>g(!1),followUpId:f,onSave:()=>{k(),g(!1)}})]})}function Z(){const{data:e=[],isLoading:s,isError:a}=p(),[d,m]=w.useState(15),[x,h]=w.useState(e),[j]=g(),{data:u,isLoading:U}=f(),[_,T]=w.useState(""),[$,q]=w.useState(null),[Y,G]=w.useState(null),[K,Q]=w.useState(null),[Z,J]=w.useState(""),[X,ee]=w.useState(""),[se,ae]=w.useState(""),[te,le]=w.useState([]),[ie,ne]=w.useState(!1),re=e.filter((e=>(""===_||e.organisation.toLowerCase().includes(_.toLowerCase()))&&(null===$||e.status===$)&&(null===Y||e.source===Y)&&(null===K||`${e.firstName} ${e.lastName}`.toLowerCase().includes(K.toLowerCase()))&&(""===Z||e.email.toLowerCase().includes(Z.toLowerCase()))&&(""===X||e.phone.toLowerCase().includes(X.toLowerCase())))),de=re?.filter((e=>te.includes(e._id)))?.map((e=>e.email))?.join(", "),oe=(e,s)=>{h((a=>a.map((a=>a.companyName===e.companyName?{...a,totalTasks:s}:a))))};return t.jsxs("div",{className:"p-4",children:[te.length>0&&t.jsx("div",{className:"mb-4",children:t.jsxs(c,{onClick:()=>ne(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",te.length,")"]})}),t.jsx(l,{open:ie,onOpenChange:ne,children:t.jsxs(i,{className:"max-w-4xl",children:[t.jsx(n,{children:t.jsx(r,{children:"Send Email to Selected Inquiries"})}),t.jsx(H,{defaultTo:de,onSuccess:()=>{ne(!1),le([])}})]})}),t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),t.jsx(v,{to:"/add-inquiry",children:t.jsxs(c,{className:"gap-2",children:[t.jsx(N,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),t.jsxs(F,{className:"border",children:[t.jsxs(L,{children:[t.jsxs(I,{className:"border-b bg-gray-100",children:[t.jsx(E,{className:"w-12"}),t.jsx(E,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),t.jsx(E,{className:"text-left",children:"Info"}),t.jsx(E,{className:"text-left",children:"Message"}),t.jsx(E,{className:"text-left",children:"Follow Up"}),t.jsx(E,{className:"w-[80px] text-left",children:"Actions"})]}),t.jsxs(I,{className:"border-b",children:[t.jsx(E,{}),t.jsx(E,{}),t.jsx(E,{children:t.jsx(o,{placeholder:"Search Info",className:"w-[200px]",value:K||"",onChange:e=>Q(e.target.value)})}),t.jsx(E,{children:t.jsx(y,{value:$||"reset",onValueChange:e=>q("reset"===e?null:e),children:t.jsxs(C,{children:[t.jsx(b,{value:"reset",children:"All Statuses"}),u?.data?.map((e=>t.jsx(b,{value:e.status,children:e.status},e._id)))]})})}),t.jsx(E,{}),t.jsx(E,{})]})]}),t.jsx(A,{children:re.map(((e,s)=>t.jsxs(I,{className:"border-b",children:[t.jsx(D,{className:"p-5",children:t.jsx(B,{checked:te.includes(e._id),onCheckedChange:()=>{return s=e._id,void le((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),t.jsx(D,{className:"sticky left-0 bg-background",children:e.createdAt.slice(0,10)}),t.jsx(D,{children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"font-medium",children:[e.firstName," ",e.lastName,","]}),e.organisation," ,",t.jsx("div",{className:"text-sm text-muted-foreground",children:e.email}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.phone," • ",e.address]})]})}),t.jsx(D,{children:e.message}),t.jsx(D,{className:"text-left",children:t.jsx(W,{inquiry:e,onFollowUpAdded:oe})}),t.jsx(D,{className:"text-center",children:t.jsxs(P,{children:[t.jsx(M,{asChild:!0,children:t.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:t.jsx(R,{className:"h-4 w-4"})})}),t.jsxs(V,{align:"end",className:"w-[160px]",children:[t.jsx(v,{to:`/edit-inquiry/${e._id}`,children:t.jsx(z,{children:"Edit"})}),t.jsx(z,{onClick:()=>(async e=>{O.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await j(e),h((s=>s.filter((s=>s._id!==e))))}catch(s){}}})})(e._id),children:"Delete"})]})]})})]},s)))})]}),t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm",children:"Items per page:"}),t.jsxs(y,{value:d.toString(),onValueChange:e=>m(Number(e)),children:[t.jsx(S,{className:"w-[70px]",children:t.jsx(k,{children:d})}),t.jsxs(C,{children:[t.jsx(b,{value:"15",children:"15"}),t.jsx(b,{value:"25",children:"25"}),t.jsx(b,{value:"50",children:"50"}),t.jsx(b,{value:"100",children:"100"})]})]})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(d,re.length)} of ${re.length}`})]})]})}export{Z as default};
//# sourceMappingURL=InquiryTable-DWs0FcqZ.js.map
