import{c as e,ah as s,j as a,ai as l,aj as i,B as r,ak as c,al as t,am as n,I as d,an as o,ao as h,ap as m,aq as x,ar as u,as as j,at as p,P as f,T as g,e as C,f as N,g as b,h as v,i as w,au as y,av as S,aw as L,ax as k,ay as A,az as _,aA as I,aB as E}from"./main-CzSo-TQq.js";import{b as F,f as T,L as B}from"./vendor-BCMiqwDy.js";import{S as z,a as D,b as M,c as O,d as $}from"./select-v0vOS5HG.js";import{D as P,a as U,b as V,c as q}from"./dropdown-menu-DmD2_E8Q.js";import{C as H}from"./checkbox-B8rDcY9L.js";import"./textarea-DYE5AoRU.js";import{S as J}from"./sweetalert2.esm.all-D2QuJ--x.js";import{M as Y}from"./mail-DrtlK33F.js";import{A as G,a as Q,b as R,c as W,d as K,e as X,f as Z,g as ee}from"./alert-dialog-DUYkMjib.js";import{C as se}from"./chevron-left-1rG-FoCP.js";import{C as ae}from"./chevron-right-BuWKzX76.js";import{a as le}from"./utils-ZFgnvnbw.js";import{C as ie}from"./circle-plus-fimQjnyQ.js";import{E as re}from"./ellipsis-vertical-BKj02QtP.js";import"./index-C6jzH1EM.js";import"./index-prcspqn7.js";import"./check-BBACUXZH.js";import"./chevron-up-BeGHc2Vw.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=e("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),te=({selectedSupplier:e,supplier:h,email:m,name:x,type:u,chemicalName:j})=>{const[p,f]=F.useState(""),[g,C]=F.useState(""),[N,b]=F.useState(!1),[v,w]=F.useState(null),{data:y,isLoading:S,error:L}=s(),k=y?.data||[],A="Customer"===u&&Array.isArray(h)&&h[0]?.email?h[0].email:m;F.useEffect((()=>{}),[h]);return a.jsx("div",{children:a.jsxs(l,{children:[a.jsx(i,{asChild:!0,children:a.jsxs(r,{variant:"secondary",children:[a.jsx(Y,{className:"w-4 h-4 mr-2"}),"Send Email (",e.length,")"]})}),a.jsxs(c,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsx(t,{children:a.jsx(n,{children:"Send Email to Selected Suppliers"})}),a.jsxs("div",{className:"grid gap-4 ",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),a.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:A})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),a.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:a.jsx("div",{className:"text-sm py-1",children:j})})]})]}),a.jsxs(z,{onValueChange:e=>{const s=k.find((s=>s._id===e));w(s),f(s?.body||""),C(s?.subject||"")},children:[a.jsx(D,{children:a.jsx(M,{placeholder:"Select email template"})}),a.jsx(O,{children:S?a.jsx($,{value:"",disabled:!0,children:"Loading..."}):L?a.jsx($,{value:"",disabled:!0,children:"Error loading templates"}):k.map((e=>a.jsx($,{value:e._id,children:e.name},e._id)))})]}),a.jsx(d,{placeholder:"Subject",value:g,onChange:e=>C(e.target.value)}),a.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:a.jsx(o,{value:p,onChange:f,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),a.jsx(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:async()=>{try{b(!0);const e={subject:g,message:p,recipients:Array.isArray(A)?A:[A],chemicalNames:Array.isArray(j)?j:[j]},s=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await s.json();if(!s.ok)throw new Error(a.message||"Failed to send email");alert("Email sent successfully!"),f(""),C("")}catch(e){alert("Failed to send email: "+e.message)}finally{b(!1)}},disabled:N,children:N?"Sending...":"Send Email"})]})]})]})})},ne=({refetch:e,open:s,onClose:i,chemicalName:o,fetchChemicals:x,chemicalId:u,supplier:j,onAddSupplier:p=[]})=>{const[f,g]=F.useState(""),[C,N]=F.useState(null);F.useEffect((()=>{s&&(g(""),N(null))}),[s]);const[b,{isLoading:v}]="Supplier"===j?h():m(),w=Array.isArray(p)?p.filter((e=>e.name?.toLowerCase().includes(f.toLowerCase()))):[];return a.jsx(l,{open:s,onOpenChange:e=>!e&&i(),children:a.jsxs(c,{className:"max-w-lg p-6",children:[a.jsx(t,{children:a.jsxs(n,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",j," for ",o.name]})}),a.jsxs("div",{className:"mt-4",children:[a.jsx(d,{placeholder:`Search ${j}`,value:f,onChange:e=>g(e.target.value),className:"w-full mb-2"}),f&&!C&&a.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:w.length>0?w.map((e=>a.jsx("div",{onClick:()=>(e=>{N(e),g(e.name)})(e),className:"p-2 cursor-pointer hover:bg-gray-100",children:e.name},e.id))):a.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",j.toLowerCase(),"s"]})}),a.jsxs("div",{className:"flex justify-between mt-4",children:[a.jsx(r,{onClick:async()=>{if(C)try{let s;s="Supplier"===j?await b({chemical_ids:[o._id],supplierId:C._id}).unwrap():await b({chemicalId:[o._id],customerId:C._id}).unwrap(),await e(),x(),i()}catch(s){alert(`Failed to add ${j.toLowerCase()}. Please try again.`)}},className:"bg-[#3b1f91] hover:bg-purple-700",disabled:v||!C,children:v?"Adding...":"+ Add"}),a.jsx(r,{onClick:i,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function de({chemicalName:e,supplier:s,fetchChemicals:l,chemicalId:i}){const[c,t]=F.useState([]),[n,d]=F.useState(!1),[o,h]=F.useState(""),[m,S]=F.useState(""),[L,k]=F.useState(""),[A,_]=F.useState(""),[I,E]=F.useState(null),{selectedItem:T}=F.useContext(x),{data:B=[],isLoading:z,error:D,refetch:M}=u(i),{data:O}=j(),[$,{isLoading:P}]=p(),U=B.filter((e=>e.name.toLowerCase().includes(o.toLowerCase())&&e.email.toLowerCase().includes(m.toLowerCase())&&e.mobile.toLowerCase().includes(L.toLowerCase())&&e.country.toLowerCase().includes(A.toLowerCase())));return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[s," for ",T?.name||"Chemical"]}),a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>d(!0),children:[a.jsx(f,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),e&&a.jsx(ne,{open:n,onClose:()=>d(!1),chemicalName:T||"Unknown Chemical",supplier:"Supplier",onAddSupplier:O,chemicalId:i,refetch:M,fetchChemicals:l})]}),c.length>0&&a.jsx("div",{className:"p-4 border-b",children:a.jsx(te,{selectedSupplier:c,supplier:B,email:B.filter((e=>c.includes(e._id))).map((e=>e.email)).join(", "),name:B.filter((e=>c.includes(e._id))).map((e=>e.name)).join(", "),chemicalName:T?.name})}),a.jsxs(g,{children:[a.jsx(C,{children:a.jsxs(N,{children:[a.jsx(b,{className:"w-12"}),a.jsx(b,{children:"Name"}),a.jsx(b,{children:"Email"}),a.jsx(b,{children:"Mobile"}),a.jsx(b,{children:"Action"})]})}),a.jsxs(v,{children:[z&&a.jsx(N,{children:a.jsx(w,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),D&&a.jsx(N,{children:a.jsx(w,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!z&&!D&&U.map((e=>a.jsxs(N,{children:[a.jsx(w,{children:a.jsx(H,{checked:c.includes(e._id),onCheckedChange:()=>{return s=e._id,void t((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),a.jsx(w,{children:e.name}),a.jsx(w,{children:e.email}),a.jsx(w,{children:e.mobile}),a.jsx(w,{children:a.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>{return s=e._id,void E(s);var s},disabled:P,children:a.jsx(y,{className:"w-4 h-4"})})})]},e._id)))]})]}),a.jsx(G,{open:!!I,onOpenChange:()=>E(null),children:a.jsxs(Q,{children:[a.jsxs(R,{children:[a.jsx(W,{children:"Are you sure?"}),a.jsx(K,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),a.jsxs(X,{children:[a.jsx(Z,{children:"Cancel"}),a.jsx(ee,{onClick:async()=>{if(I)try{await $({supplierId:I,chemicalId:i}).unwrap(),M()}catch(e){alert("Failed to delete chemical")}E(null)},children:"Delete"})]})]})})]})}function oe({chemicalName:e,supplier:s}){const[l,i]=F.useState([]),{selectedItem:c}=F.useContext(x),[t,n]=F.useState(!1),[d,o]=F.useState(""),[h,m]=F.useState(""),[u,j]=F.useState(""),[p,A]=F.useState(""),{data:_=[]}=S(),{data:I=[],isLoading:E,error:T,refetch:B}=L(c._id),[z]=k(),D=I.filter((e=>e.name.toLowerCase().includes(d.toLowerCase())&&e.email.toLowerCase().includes(h.toLowerCase())&&e.mobile.toLowerCase().includes(u.toLowerCase())&&e.country.toLowerCase().includes(p.toLowerCase())));return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[s," for ",c.name]}),a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>n(!0),children:[a.jsx(f,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),a.jsx(ne,{open:t,onClose:()=>n(!1),chemicalName:c,supplier:"Customer",onAddSupplier:_,refetch:B}),l.length>0&&a.jsx("div",{className:"p-4 border-b",children:a.jsx(te,{selectedSupplier:l,supplier:I,chemicalName:e.name,type:s})}),a.jsxs("div",{className:"border rounded-lg",children:[a.jsxs(g,{children:[a.jsx(C,{children:a.jsxs(N,{children:[a.jsx(b,{className:"w-12"}),a.jsx(b,{children:"Name"}),a.jsx(b,{children:"Email"}),a.jsx(b,{children:"Mobile"}),a.jsx(b,{children:"Country"}),a.jsx(b,{children:"Action"})]})}),a.jsxs(v,{children:[E&&a.jsx(N,{children:a.jsx(w,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),T&&a.jsx(N,{children:a.jsx(w,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!E&&!T&&0===D.length&&a.jsx(N,{children:a.jsx(w,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!E&&!T&&D.map((e=>a.jsxs(N,{children:[a.jsx(w,{children:a.jsx(H,{checked:l.includes(e.id),onCheckedChange:()=>{return s=e.id,void i((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),a.jsx(w,{children:e.name}),a.jsx(w,{children:e.email}),a.jsx(w,{children:e.mobile}),a.jsx(w,{children:e.country}),a.jsx(w,{children:a.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>(async e=>{try{await z({customerId:e,chemicalId:c._id})}catch(s){}})(e._id),children:a.jsx(y,{className:"w-4 h-4"})})})]},e.id)))]})]}),a.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx("span",{children:"Items per page: 10"}),a.jsxs("span",{children:["1 - ",D.length," of ",D.length]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(r,{variant:"outline",size:"icon",disabled:!0,children:a.jsx(se,{className:"w-4 h-4"})}),a.jsx(r,{variant:"outline",size:"icon",disabled:!0,children:a.jsx(ae,{className:"w-4 h-4"})})]})]})]})]})}function he(){const{selectedChemicalName:e,setChemicalName:s}=A(),[i,t]=F.useState(!1),[n,o]=F.useState(!1),[h,m]=F.useState(null),[x,u]=F.useState(""),[p,f]=F.useState(""),[L,k]=F.useState(1),[H,Y]=F.useState(20),[G,Q]=F.useState(!1),[R,W]=F.useState(null),[K,X]=F.useState(!1),[Z,ee]=F.useState(null),[se,ae]=F.useState([]),{data:te=[],isLoading:he,error:me}=j(),{data:xe=[],isLoading2:ue,error2:je}=S();_(h?._id);const pe=T(),[fe,ge]=F.useState(0);F.useEffect((()=>{Ce()}),[fe]);const Ce=async()=>{try{const e=await le.get("/api/chemical/get");ae(e.data)}catch(e){}},Ne=se.filter((e=>{const s=e.name||"",a=e.casNumber||"";return s.toLowerCase().includes(x.toLowerCase())&&a.includes(p)})),be=Ne.slice((L-1)*H,L*H);return a.jsxs("div",{className:"w-full",children:[a.jsxs("div",{className:"flex justify-between items-center mb-5",children:[a.jsx("div",{children:a.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),a.jsx("div",{children:a.jsx(B,{to:"/chemical-form",children:a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[a.jsx(ie,{})," Add Chemical"]})})})]}),a.jsx("div",{className:"mb-5",children:a.jsx("hr",{})}),a.jsx("div",{className:"rounded-md border",children:a.jsxs(g,{children:[a.jsxs(C,{children:[a.jsxs(N,{children:[a.jsx(b,{className:"w-[50px]"}),a.jsx(b,{children:"Name"}),a.jsx(b,{children:"CAS Number"}),a.jsx(b,{children:"Molecular Formula"}),a.jsx(b,{children:"Suppliers"}),a.jsx(b,{children:"Customers"}),a.jsx(b,{children:"Unit Name"})]}),a.jsxs(N,{children:[a.jsx(b,{className:"w-[50px]"}),a.jsx(b,{children:a.jsx(d,{placeholder:"Filter by Name",value:x,onChange:e=>u(e.target.value)})}),a.jsx(b,{children:a.jsx(d,{placeholder:"Filter by CAS Number",value:p,onChange:e=>f(e.target.value)})}),a.jsx(b,{}),a.jsx(b,{}),a.jsx(b,{}),a.jsx(b,{})]})]}),a.jsx(v,{children:be.map((e=>a.jsxs(N,{children:[a.jsx(w,{children:a.jsxs(P,{children:[a.jsx(U,{asChild:!0,children:a.jsx("button",{className:"p-3",children:a.jsx(re,{className:"h-4 w-4"})})}),a.jsxs(V,{children:[a.jsxs(q,{onClick:()=>(e=>{pe(`/edit-chemical-form/${e._id}`)})(e),children:[a.jsx(I,{className:"mr-2 h-4 w-4"}),"Edit"]}),a.jsxs(q,{onClick:()=>(e=>{m(e),Q(!0),ee("supplier")})(e),children:[a.jsx(ce,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),a.jsxs(q,{onClick:()=>(e=>{m(e),X(!0),ee("customer")})(e),children:[a.jsx(ce,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),a.jsxs(q,{onClick:()=>(async e=>{try{if((await J.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const s=await le.delete(`/api/chemical/delete?id=${e._id}`);if(!s.data.success&&"Chemical deleted successfully"!==s.data.message)throw new Error(s.data.message||"Failed to delete the chemical");ae((s=>s.filter((s=>s._id!==e._id)))),await Ce(),await J.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1})}else J.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(s){"Chemical deleted successfully"===s.message?J.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):J.fire({title:"Error!",text:s.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}})(e),children:[a.jsx(y,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),a.jsx(w,{children:e.name}),a.jsx(w,{children:e.cas_number}),a.jsx(w,{children:e.molecular_formula}),a.jsx(w,{children:a.jsxs(r,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{m(e),t(!0)},children:["Suppliers (",e.supplierCount,")"]})}),a.jsx(w,{children:a.jsxs(r,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{m(e),o(!0)},children:["Customers(",e.customerCount,")"]})}),a.jsx(w,{children:e.unit})]},e.id)))}),h&&a.jsx(ne,{open:"supplier"===Z?G:K,onClose:()=>{"supplier"===Z?Q(!1):X(!1),ee(null),ge((e=>e+1)),Ce()},chemicalName:h.name,supplier:"supplier"===Z?"Supplier":"Customer",onAddSupplier:"supplier"===Z?te:xe,chemicalId:h._id,fetchChemicals:Ce})]})}),a.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),a.jsxs(z,{defaultValue:H.toString(),onValueChange:e=>{Y(Number(e)),k(1)},children:[a.jsx(D,{className:"w-[70px]",children:a.jsx(M,{placeholder:H.toString()})}),a.jsxs(O,{children:[a.jsx($,{value:"10",children:"10"}),a.jsx($,{value:"20",children:"20"}),a.jsx($,{value:"30",children:"30"}),a.jsx($,{value:"40",children:"40"}),a.jsx($,{value:"50",children:"50"})]})]}),a.jsx("div",{className:"text-sm font-medium",children:`${(L-1)*H+1} - ${Math.min(L*H,Ne.length)} of ${Ne.length}`})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(r,{variant:"outline",size:"icon",onClick:()=>{L>1&&k((e=>e-1))},disabled:1===L,children:"<"}),a.jsx(r,{variant:"outline",size:"icon",onClick:()=>{L*H<Ne.length&&k((e=>e+1))},disabled:L*H>=Ne.length,children:">"})]})]}),a.jsx(E,{selectedItem:h,children:h&&a.jsxs(a.Fragment,{children:[a.jsx(l,{open:i,onOpenChange:t,children:a.jsx(c,{className:"max-w-6xl",children:a.jsx(de,{chemicalName:h,chemicalId:h._id,supplier:"Supplier",fetchChemicals:Ce})})}),a.jsx(l,{open:n,onOpenChange:o,children:a.jsx(c,{className:"max-w-6xl",children:a.jsx(oe,{selectedItems:h,supplier:"Customer",chemicalName:h,chemicalId:h._id,onUpdate:()=>{Ce(),ge((e=>e+1))}})})})]})})]})}export{he as default};
//# sourceMappingURL=ChemicalTablePage-BJiG1B09.js.map
